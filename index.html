<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Ê≠£ÊúàÁâπË®ì„ÅÆ„Åæ„Å°Èßø„Éù„É≠ - 2026</title>
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none !important;
      -webkit-user-select: none !important;
      -khtml-user-select: none !important;
      -moz-user-select: none !important;
      -ms-user-select: none !important;
      user-select: none !important;
    }

    html, body {
      touch-action: manipulation;
      -webkit-touch-callout: none !important;
      overscroll-behavior: none;
      -webkit-user-drag: none;
      -webkit-text-size-adjust: none;
    }

    img, a, div, button, span {
      -webkit-touch-callout: none !important;
      -webkit-user-select: none !important;
      pointer-events: auto;
    }

    :root {
      --snow-bg: #1a1a2e;
      --ground-color: #e8f4f8;
      --building-warm: #ffd93d;
      --text-color: #fff;
    }

    body {
      background: linear-gradient(180deg, #0f0f23 0%, #1a1a3e 50%, #2d2d5a 100%);
      min-height: 100vh;
      overflow: hidden;
      font-family: 'DotGothic16', sans-serif;
      image-rendering: pixelated;
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }

    /* Èõ™„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
    .snowflakes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 100;
      overflow: hidden;
    }

    .snowflake {
      position: absolute;
      color: #fff;
      font-size: 1em;
      text-shadow: 0 0 5px #fff;
      animation: fall linear infinite;
      opacity: 0.8;
    }

    @keyframes fall {
      0% { transform: translateY(-10vh) translateX(0); opacity: 1; }
      100% { transform: translateY(110vh) translateX(50px); opacity: 0.3; }
    }

    /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä */
    .game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    /* „Çø„ÉÉ„Éó„Ç®„É™„Ç¢ÔºàÂ∑¶Âè≥ÁßªÂãïÁî®Ôºâ */
    .tap-area {
      position: fixed;
      top: 0;
      width: 50%;
      height: 100%;
      z-index: 50;
      cursor: pointer;
    }

    .tap-area.left { left: 0; }
    .tap-area.right { right: 0; }

    .tap-indicator {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 40px;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
    }

    .tap-area.left .tap-indicator { left: 20px; }
    .tap-area.right .tap-indicator { right: 20px; }

    .tap-area:active .tap-indicator { opacity: 0.5; }

    /* ËÉåÊôØ„ÅÆÂ±±„ÄÖ */
    .mountains {
      position: absolute;
      bottom: 230px;
      left: 0;
      width: 200%;
      height: 200px;
      z-index: 1;
    }

    .mountain {
      position: absolute;
      bottom: 0;
      width: 0;
      height: 0;
      border-style: solid;
    }

    .mountain-1 { left: 5%; border-width: 0 80px 120px 80px; border-color: transparent transparent #3d3d6b transparent; }
    .mountain-2 { left: 20%; border-width: 0 120px 180px 120px; border-color: transparent transparent #2d2d5a transparent; }
    .mountain-3 { left: 50%; border-width: 0 100px 150px 100px; border-color: transparent transparent #3d3d6b transparent; }
    .mountain-4 { left: 75%; border-width: 0 90px 130px 90px; border-color: transparent transparent #2d2d5a transparent; }

    /* Âú∞Èù¢ */
    .ground {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 230px;
      background: linear-gradient(180deg, #c8e6f0 0%, #e8f4f8 30%, #fff 100%);
      z-index: 2;
    }

    /* Áî∫„Ç®„É™„Ç¢ */
    .town {
      position: absolute;
      bottom: 110px;
      left: 0;
      width: 100%;
      height: 300px;
      z-index: 10;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 60px;
      padding: 0 15px;
    }

    /* „Çπ„Éû„ÉõÂêë„ÅëË™øÊï¥ */
    @media screen and (max-width: 480px) {
      .ground {
        height: 200px;
      }
      
      .town {
        bottom: 90px;
        gap: 30px;
        padding: 0 10px;
      }
      
      .building {
        transform: scale(0.7);
      }
      
      .dojo-sign, .shrine-sign {
        font-size: 8px;
        padding: 3px 6px;
        top: -40px;
      }
    }

    /* Âª∫Áâ©ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
    .building {
      position: relative;
      cursor: pointer;
      transition: transform 0.2s ease;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
      z-index: 55;
      pointer-events: auto;
    }

    .building:active {
      transform: translateY(-5px) scale(1.02);
    }

    .building-glow {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 120%;
      height: 40px;
      background: radial-gradient(ellipse at center, rgba(255, 217, 61, 0.4) 0%, transparent 70%);
      opacity: 0.5;
    }

    /* ÈÅéÂéªÂïèÈÅìÂ†¥ */
    .dojo {
      width: 140px;
    }

    .dojo-body {
      width: 140px;
      height: 110px;
      background: linear-gradient(180deg, #8b4513 0%, #654321 100%);
      border: 4px solid #3d2914;
      position: relative;
    }

    .dojo-roof {
      width: 160px;
      height: 55px;
      background: #1a1a2e;
      position: relative;
      left: -10px;
      clip-path: polygon(0% 100%, 50% 0%, 100% 100%);
    }

    .dojo-roof::after {
      content: '';
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 50px;
      background: #2d2d4a;
      clip-path: polygon(0% 100%, 50% 0%, 100% 100%);
    }

    .dojo-window {
      position: absolute;
      width: 35px;
      height: 45px;
      background: var(--building-warm);
      border: 3px solid #3d2914;
      top: 20px;
      box-shadow: 0 0 20px rgba(255, 217, 61, 0.6);
    }

    .dojo-window.left { left: 15px; }
    .dojo-window.right { right: 15px; }

    .dojo-door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 55px;
      background: #2d1810;
      border: 3px solid #1a0f0a;
    }

    .dojo-sign {
      position: absolute;
      top: -50px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(59, 41, 20, 0.7);
      color: rgba(255, 255, 255, 0.8);
      padding: 4px 8px;
      font-size: 9px;
      border: 1px solid rgba(139, 69, 19, 0.5);
      white-space: nowrap;
      pointer-events: none;
      opacity: 0.8;
    }

    /* Á•ûÁ§æÔºàÊôÇ‰∫ãÂïèÈ°åÔºâ */
    .shrine {
      width: 150px;
    }

    .torii {
      width: 120px;
      height: 80px;
      position: relative;
      margin: 0 auto 10px;
    }

    .torii-top {
      position: absolute;
      top: 0;
      left: -15px;
      width: 150px;
      height: 18px;
      background: #c41e3a;
      border-radius: 3px;
    }

    .torii-beam {
      position: absolute;
      top: 25px;
      left: 0;
      width: 120px;
      height: 12px;
      background: #c41e3a;
    }

    .torii-pillar {
      position: absolute;
      top: 18px;
      width: 14px;
      height: 62px;
      background: #c41e3a;
    }

    .torii-pillar.left { left: 12px; }
    .torii-pillar.right { right: 12px; }

    .shrine-body {
      width: 150px;
      height: 90px;
      background: linear-gradient(180deg, #f5f5f5 0%, #e0e0e0 100%);
      border: 4px solid #bbb;
      position: relative;
    }

    .shrine-roof {
      width: 170px;
      height: 50px;
      background: #2d4a2d;
      position: relative;
      left: -10px;
      clip-path: polygon(0% 100%, 10% 0%, 90% 0%, 100% 100%);
    }

    .shrine-door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 45px;
      height: 55px;
      background: #8b4513;
      border: 3px solid #654321;
    }

    .shrine-lantern {
      position: absolute;
      bottom: 65px;
      width: 22px;
      height: 32px;
      background: #ff6b6b;
      border-radius: 5px;
      box-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
      animation: lanternGlow 2s ease-in-out infinite alternate;
    }

    @keyframes lanternGlow {
      0% { box-shadow: 0 0 15px rgba(255, 107, 107, 0.6); }
      100% { box-shadow: 0 0 25px rgba(255, 107, 107, 1); }
    }

    .shrine-lantern.left { left: 15px; }
    .shrine-lantern.right { right: 15px; }

    .shrine-sign {
      position: absolute;
      top: -50px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(139, 69, 19, 0.5);
      color: rgba(255, 255, 255, 0.8);
      padding: 4px 8px;
      font-size: 9px;
      border: 1px solid rgba(139, 69, 19, 0.4);
      white-space: nowrap;
      pointer-events: none;
      opacity: 0.8;
    }

    /* Êú®„ÄÖ */
    .tree {
      position: absolute;
      z-index: 5;
    }

    .tree-trunk {
      width: 20px;
      height: 40px;
      background: #4a3728;
      margin: 0 auto;
    }

    .tree-snow {
      width: 60px;
      height: 80px;
      background: radial-gradient(ellipse at center, #e8f4f8 0%, #c8dae8 100%);
      border-radius: 50%;
      position: relative;
      left: -20px;
    }

    .tree-snow::before {
      content: '';
      position: absolute;
      top: -30px;
      left: 10px;
      width: 40px;
      height: 50px;
      background: radial-gradient(ellipse at center, #e8f4f8 0%, #c8dae8 100%);
      border-radius: 50%;
    }

    .tree.t1 { left: 3%; bottom: 250px; transform: scale(0.8); }
    .tree.t2 { right: 3%; bottom: 260px; transform: scale(0.9); }

    /* „Éó„É¨„Ç§„É§„ÉºÔºà„Éï„É™„Çπ„ÇØÈ¢®„Ç≠„É£„É©„ÇØ„Çø„ÉºÔºâ */
    .player {
      position: absolute;
      bottom: 135px;
      left: 88%;
      transform: translateX(-50%);
      z-index: 60;
      transition: left 0.2s ease-out;
    }

    /* „Éï„É™„Çπ„ÇØÈ¢®„Éî„ÇØ„Çª„É´„Ç≠„É£„É©„ÇØ„Çø„Éº */
    .frisk {
      width: 32px;
      height: 48px;
      position: relative;
      image-rendering: pixelated;
      transform: scale(1.5);
      filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4));
    }

    .frisk.flip {
      transform: scale(1.5) scaleX(-1);
    }

    .frisk.walking {
      animation: friskWalk 0.3s steps(2) infinite;
    }

    @keyframes friskWalk {
      0% { transform: scale(1.5) translateY(0); }
      50% { transform: scale(1.5) translateY(-3px); }
      100% { transform: scale(1.5) translateY(0); }
    }

    .frisk.flip.walking {
      animation: friskWalkFlip 0.3s steps(2) infinite;
    }

    @keyframes friskWalkFlip {
      0% { transform: scale(1.5) scaleX(-1) translateY(0); }
      50% { transform: scale(1.5) scaleX(-1) translateY(-3px); }
      100% { transform: scale(1.5) scaleX(-1) translateY(0); }
    }

    /* È´™„ÅÆÊØõ */
    .frisk-hair {
      position: absolute;
      top: 0;
      left: 4px;
      width: 24px;
      height: 20px;
      background: #8B4513;
      border-radius: 8px 8px 0 0;
    }

    .frisk-hair::before {
      content: '';
      position: absolute;
      top: 12px;
      left: -2px;
      width: 8px;
      height: 14px;
      background: #8B4513;
      border-radius: 0 0 4px 4px;
    }

    .frisk-hair::after {
      content: '';
      position: absolute;
      top: 12px;
      right: -2px;
      width: 8px;
      height: 14px;
      background: #8B4513;
      border-radius: 0 0 4px 4px;
    }

    /* È°î */
    .frisk-face {
      position: absolute;
      top: 10px;
      left: 8px;
      width: 16px;
      height: 14px;
      background: #FFDAB9;
      border-radius: 2px;
    }

    /* ‰ΩìÔºàÈùí„Å®Á¥´„ÅÆ„Çπ„Éà„É©„Ç§„Éó„Ç∑„É£„ÉÑÔºâ */
    .frisk-body {
      position: absolute;
      top: 24px;
      left: 6px;
      width: 20px;
      height: 14px;
      background: linear-gradient(
        to bottom,
        #4169E1 0%, #4169E1 33%,
        #9370DB 33%, #9370DB 66%,
        #4169E1 66%, #4169E1 100%
      );
      border-radius: 2px;
    }

    /* ËÖï */
    .frisk-arms {
      position: absolute;
      top: 26px;
      left: 2px;
      width: 4px;
      height: 10px;
      background: #FFDAB9;
      border-radius: 2px;
    }

    .frisk-arms::after {
      content: '';
      position: absolute;
      left: 24px;
      width: 4px;
      height: 10px;
      background: #FFDAB9;
      border-radius: 2px;
    }

    /* Ë∂≥ */
    .frisk-legs {
      position: absolute;
      top: 38px;
      left: 8px;
      width: 6px;
      height: 10px;
      background: #8B4513;
      border-radius: 0 0 2px 2px;
    }

    .frisk-legs::after {
      content: '';
      position: absolute;
      left: 10px;
      width: 6px;
      height: 10px;
      background: #8B4513;
      border-radius: 0 0 2px 2px;
    }

    /* Ë∂≥ÂÖÉ„ÅÆÂΩ± */
    .frisk::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 6px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 50%;
    }

    /* „Çπ„Éû„ÉõÂêë„Åë„Éó„É¨„Ç§„É§„ÉºË™øÊï¥ */
    @media screen and (max-width: 480px) {
      .player {
        bottom: 115px;
      }
      
      .frisk {
        transform: scale(1.2);
      }
      
      .frisk.flip {
        transform: scale(1.2) scaleX(-1);
      }
      
      .frisk.walking {
        animation: friskWalkSp 0.3s steps(2) infinite;
      }
      
      .frisk.flip.walking {
        animation: friskWalkFlipSp 0.3s steps(2) infinite;
      }
      
      @keyframes friskWalkSp {
        0% { transform: scale(1.2) translateY(0); }
        50% { transform: scale(1.2) translateY(-3px); }
        100% { transform: scale(1.2) translateY(0); }
      }
      
      @keyframes friskWalkFlipSp {
        0% { transform: scale(1.2) scaleX(-1) translateY(0); }
        50% { transform: scale(1.2) scaleX(-1) translateY(-3px); }
        100% { transform: scale(1.2) scaleX(-1) translateY(0); }
      }
    }

    /* UIË¶ÅÁ¥† */
    .ui-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 200;
      padding: 10px;
      pointer-events: none;
    }

    .title-box {
      background: rgba(0, 0, 0, 0.85);
      border: 3px solid #ffd93d;
      padding: 8px 15px;
      display: inline-block;
      position: relative;
    }

    .title-box h1 {
      color: #ffd93d;
      font-size: 18px;
      text-shadow: 2px 2px 0 #000;
      margin-bottom: 2px;
    }

    .title-box .subtitle {
      color: #fff;
      font-size: 10px;
    }

    .title-box .year-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #c41e3a;
      color: #fff;
      padding: 3px 6px;
      font-size: 10px;
      border: 2px solid #ffd93d;
    }

    .controls-hint {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #888;
      padding: 6px 10px;
      margin-top: 6px;
      display: inline-block;
    }

    .controls-hint p {
      color: #ccc;
      font-size: 10px;
      margin: 1px 0;
    }

    /* „Çπ„Éû„ÉõÂêë„ÅëUIË™øÊï¥ */
    @media screen and (max-width: 480px) {
      .ui-overlay {
        padding: 5px;
      }
      
      .title-box {
        padding: 6px 10px;
        border-width: 2px;
      }
      
      .title-box h1 {
        font-size: 14px;
      }
      
      .title-box .subtitle {
        font-size: 9px;
      }
      
      .title-box .year-badge {
        padding: 2px 4px;
        font-size: 8px;
        top: -8px;
        right: -8px;
      }
      
      .controls-hint {
        padding: 4px 8px;
        margin-top: 4px;
      }
      
      .controls-hint p {
        font-size: 9px;
      }
    }

    /* ÊòüÁ©∫ */
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60%;
      z-index: 0;
    }

    .star {
      position: absolute;
      width: 3px;
      height: 3px;
      background: #fff;
      border-radius: 50%;
      animation: twinkle 2s ease-in-out infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    /* Ë°óÁÅØ */
    .lamp-post {
      position: absolute;
      z-index: 8;
    }

    .lamp-pole {
      width: 8px;
      height: 80px;
      background: #333;
      margin: 0 auto;
    }

    .lamp-light {
      width: 25px;
      height: 20px;
      background: #ffd93d;
      border-radius: 5px 5px 10px 10px;
      position: relative;
      left: -8px;
      box-shadow: 0 0 30px rgba(255, 217, 61, 0.8), 0 0 60px rgba(255, 217, 61, 0.4);
    }

    .lamp-post.l1 { left: 15%; bottom: 230px; }
    .lamp-post.l2 { right: 15%; bottom: 230px; }

    /* ÈñÄÊùæ */
    .kadomatsu {
      position: absolute;
      font-size: 45px;
      z-index: 15;
    }

    .kadomatsu.k1 { left: 1%; bottom: 230px; }
    .kadomatsu.k2 { right: 1%; bottom: 230px; }

    /* ========== NPC„Ç≠„É£„É©„ÇØ„Çø„Éº ========== */
    .npc {
      position: absolute;
      z-index: 45;
      cursor: pointer;
    }

    /* Super happy */
    .npc-kitataya {
      bottom: 145px;
      right: 22%;
    }

    .kitataya-head {
      width: 38px;
      height: 38px;
      background: #ffd5b5;
      border-radius: 50%;
      margin: 0 auto;
      position: relative;
      border: 2px solid #d4a574;
    }

    .kitataya-hair {
      position: absolute;
      top: -5px;
      left: -3px;
      width: 44px;
      height: 28px;
      background: #2d2d2d;
      border-radius: 50% 50% 0 0;
    }

    .kitataya-eyes {
      position: absolute;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }

    .kitataya-eye {
      width: 5px;
      height: 5px;
      background: #000;
      border-radius: 50%;
    }

    .kitataya-smile {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 14px;
      height: 7px;
      border: 2px solid #c41e3a;
      border-top: none;
      border-radius: 0 0 10px 10px;
    }

    .kitataya-body {
      width: 32px;
      height: 38px;
      background: linear-gradient(180deg, #4a90d9 0%, #3a7bc8 100%);
      margin: 0 auto;
      border-radius: 5px 5px 0 0;
      position: relative;
    }

    .kitataya-tie {
      position: absolute;
      top: 2px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 10px solid #c41e3a;
    }

    .npc-name {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      color: #7fff7f;
      padding: 3px 8px;
      font-size: 9px;
      white-space: nowrap;
      border: 2px solid #7fff7f;
    }

    /* „Çπ„Éû„ÉõÂêë„ÅëNPCË™øÊï¥ */
    @media screen and (max-width: 480px) {
      .npc-kitataya {
        bottom: 125px;
        transform: scale(0.8);
      }
      
      .npc-kitayama {
        bottom: 125px;
        transform: scale(0.8);
      }
      
      .npc-kitayama.appear {
        left: 5%;
      }
      
      .npc-name {
        font-size: 8px;
        padding: 2px 6px;
      }
    }

    /* „Ç≠„Çø„É§„Éû („É°„Çø„Éà„É≥È¢®) */
    .npc-kitayama {
      bottom: 145px;
      left: -100px;
      transition: left 1s ease-out;
    }

    .npc-kitayama.appear {
      left: 8%;
    }

    .kitayama-head {
      width: 34px;
      height: 40px;
      background: linear-gradient(180deg, #ffd5b5 0%, #f0c5a5 100%);
      margin: 0 auto;
      position: relative;
      border: 2px solid #d4a574;
      border-radius: 5px 5px 10px 10px;
    }

    .kitayama-hair {
      position: absolute;
      top: -10px;
      left: -6px;
      width: 46px;
      height: 32px;
      background: linear-gradient(180deg, #1a1a1a 0%, #333 100%);
      clip-path: polygon(10% 100%, 0% 40%, 20% 0%, 80% 0%, 100% 40%, 90% 100%, 70% 80%, 50% 100%, 30% 80%);
    }

    .kitayama-eyes {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
    }

    .kitayama-eye {
      width: 6px;
      height: 3px;
      background: #000;
      border-radius: 0 0 3px 3px;
    }

    .kitayama-sparkle {
      position: absolute;
      top: 8px;
      right: -2px;
      font-size: 12px;
      animation: sparkle 1s ease-in-out infinite;
    }

    @keyframes sparkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.3); }
    }

    .kitayama-smirk {
      position: absolute;
      bottom: 8px;
      left: 55%;
      transform: translateX(-50%);
      width: 12px;
      height: 5px;
      border: 2px solid #333;
      border-top: none;
      border-left: none;
      border-radius: 0 0 6px 0;
    }

    .kitayama-body {
      width: 30px;
      height: 48px;
      background: linear-gradient(180deg, #1a1a1a 0%, #333 100%);
      margin: 0 auto;
      position: relative;
      clip-path: polygon(0% 0%, 100% 0%, 90% 100%, 10% 100%);
    }

    .kitayama-collar {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 22px;
      height: 10px;
      background: #fff;
      clip-path: polygon(0% 0%, 100% 0%, 80% 100%, 20% 100%);
    }

    .kitayama-legs {
      display: flex;
      justify-content: center;
      gap: 5px;
    }

    .kitayama-leg {
      width: 9px;
      height: 16px;
      background: #1a1a1a;
    }

    /* Mr.MoriÔºàÁôΩÈ´™‰∫§„Åò„Çä„ÅÆ55Ê≠≥„ÄÅÁ≤æÂäõÁöÑ„Å™„Åä„Åò„Åï„ÇìÔºâ */
    .npc-mori {
      bottom: 145px;
      left: -100px;
      transition: left 0.8s ease-out;
    }

    .npc-mori.appear {
      left: 3%;
    }

    .mori-head {
      width: 36px;
      height: 38px;
      background: linear-gradient(180deg, #e8d5c5 0%, #d4b896 100%);
      margin: 0 auto;
      position: relative;
      border: 2px solid #c4a882;
      border-radius: 8px 8px 12px 12px;
    }

    .mori-hair {
      position: absolute;
      top: -6px;
      left: 2px;
      width: 32px;
      height: 14px;
      background: linear-gradient(90deg, #555 0%, #888 30%, #666 50%, #999 70%, #555 100%);
      border-radius: 8px 8px 0 0;
    }

    .mori-hair::before {
      content: '';
      position: absolute;
      top: 8px;
      left: -3px;
      width: 8px;
      height: 10px;
      background: linear-gradient(180deg, #666 0%, #888 50%, #666 100%);
      border-radius: 2px;
    }

    .mori-hair::after {
      content: '';
      position: absolute;
      top: 8px;
      right: -3px;
      width: 8px;
      height: 10px;
      background: linear-gradient(180deg, #666 0%, #888 50%, #666 100%);
      border-radius: 2px;
    }

    .mori-eyes {
      position: absolute;
      top: 14px;
      left: 6px;
      display: flex;
      gap: 10px;
    }

    .mori-eye {
      width: 7px;
      height: 7px;
      background: #2a2a2a;
      border-radius: 50%;
      position: relative;
    }

    .mori-eye::after {
      content: '';
      position: absolute;
      top: 1px;
      left: 2px;
      width: 3px;
      height: 3px;
      background: #fff;
      border-radius: 50%;
    }

    .mori-smile {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 14px;
      height: 7px;
      border: 2px solid #8b4513;
      border-top: none;
      border-radius: 0 0 10px 10px;
      background: transparent;
    }

    .mori-body {
      width: 34px;
      height: 28px;
      background: linear-gradient(180deg, #2e5a2e 0%, #1e4a1e 100%);
      margin: 2px auto 0;
      border-radius: 5px 5px 0 0;
      position: relative;
      border: 2px solid #1a3a1a;
    }

    .mori-body::before {
      content: '';
      position: absolute;
      top: 4px;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 10px;
      background: #f5f5dc;
      border-radius: 2px;
    }

    .mori-body::after {
      content: '';
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 8px solid #8b0000;
    }

    .mori-legs {
      display: flex;
      justify-content: center;
      gap: 6px;
    }

    .mori-leg {
      width: 10px;
      height: 14px;
      background: #2a2a2a;
    }

    /* „Çπ„Éû„ÉõÂêë„ÅëMr.MoriË™øÊï¥ */
    @media screen and (max-width: 480px) {
      .npc-mori {
        bottom: 125px;
        transform: scale(0.8);
      }
      
      .npc-mori.appear {
        left: 2%;
      }
    }

    /* „Ç§„Éô„É≥„Éà„Ç™„Éº„Éê„Éº„É¨„Ç§ */
    .event-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0);
      z-index: 280;
      pointer-events: none;
      transition: background 0.3s;
    }

    .event-overlay.active {
      background: rgba(0, 0, 0, 0.4);
      pointer-events: auto;
    }

    /* „Ç§„Éô„É≥„Éà„ÉÄ„Ç§„Ç¢„É≠„Ç∞ */
    .event-dialog {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 96%;
      max-width: 600px;
      max-height: 70vh;
      background: #000;
      border: 3px solid #fff;
      z-index: 350;
      display: none;
      overflow: hidden;
    }

    .event-dialog.active {
      display: flex;
      flex-direction: column;
      animation: dialogAppear 0.2s ease-out;
    }

    @keyframes dialogAppear {
      0% { transform: translateX(-50%) scale(0.9); opacity: 0; }
      100% { transform: translateX(-50%) scale(1); opacity: 1; }
    }

    .event-dialog-header {
      background: #222;
      padding: 8px 12px;
      border-bottom: 2px solid #444;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .speaker-icon { font-size: 24px; }
    .speaker-name { color: #ffd93d; font-size: 14px; }

    .event-dialog-content {
      padding: 12px;
      overflow-y: auto;
      flex: 1;
      min-height: 60px;
    }

    .event-dialog-content p {
      color: #fff;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .event-dialog-choices {
      padding: 10px;
      display: flex;
      gap: 8px;
      justify-content: center;
      border-top: 2px solid #333;
      flex-wrap: wrap;
      flex-shrink: 0;
      background: #000;
    }

    .choice-btn {
      background: #222;
      border: 2px solid #ffd93d;
      color: #ffd93d;
      padding: 12px 20px;
      font-family: 'DotGothic16', sans-serif;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s ease;
      min-width: 100px;
      min-height: 44px;
    }

    .choice-btn:active {
      background: #ffd93d;
      color: #000;
      transform: scale(0.95);
    }

    .choice-btn.changing {
      animation: buttonShake 0.4s ease;
    }

    @keyframes buttonShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px) rotate(-2deg); }
      40% { transform: translateX(8px) rotate(2deg); }
      60% { transform: translateX(-6px) rotate(-1deg); }
      80% { transform: translateX(6px) rotate(1deg); }
    }

    .choice-btn.forced {
      background: #c41e3a;
      border-color: #ff6b6b;
      color: #fff;
    }

    /* „Çπ„Éû„ÉõÂêë„Åë - „ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÂ§ß„Åç„ÅèË°®Á§∫ */
    @media screen and (max-width: 480px) {
      .event-dialog {
        bottom: 0;
        left: 0;
        right: 0;
        top: auto;
        transform: none;
        width: 100%;
        max-width: 100%;
        max-height: 85vh;
        border-radius: 15px 15px 0 0;
        border-width: 3px 3px 0 3px;
      }
      
      .event-dialog-header {
        padding: 10px 15px;
      }
      
      .speaker-icon { font-size: 22px; }
      .speaker-name { font-size: 14px; }
      
      .event-dialog-content {
        padding: 15px;
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .event-dialog-content p {
        font-size: 14px;
        line-height: 1.8;
      }
      
      .event-dialog-choices {
        padding: 12px 15px 20px 15px;
        gap: 10px;
        flex-wrap: wrap;
      }
      
      .choice-btn {
        padding: 14px 24px;
        font-size: 14px;
        min-width: 110px;
        min-height: 50px;
        flex: 1;
        max-width: 45%;
      }
    }

    /* Â∞è„Åï„ÅÑ„Çπ„Éû„ÉõÂêë„Åë */
    @media screen and (max-width: 360px) {
      .event-dialog {
        max-height: 90vh;
      }
      
      .event-dialog-content p {
        font-size: 13px;
        line-height: 1.7;
      }
      
      .choice-btn {
        padding: 12px 18px;
        font-size: 13px;
        min-width: 90px;
      }
    }

    /* ÊÑüÂòÜÁ¨¶„Ç®„Éï„Çß„ÇØ„Éà */
    .exclamation {
      position: fixed;
      font-size: 35px;
      color: #ff0;
      text-shadow: 0 0 10px #ff0, 2px 2px 0 #000;
      animation: exclamationPop 0.5s ease-out;
      z-index: 400;
      pointer-events: none;
    }

    @keyframes exclamationPop {
      0% { transform: scale(0) translateY(20px); opacity: 0; }
      50% { transform: scale(1.4) translateY(-10px); opacity: 1; }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }

    /* „Ç®„É≥„Éá„Ç£„É≥„Ç∞ */
    .ending-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0);
      z-index: 500;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: all 1s ease;
    }

    .ending-overlay.active {
      background: rgba(0, 0, 0, 0.9);
      opacity: 1;
      pointer-events: auto;
    }

    .ending-frisk {
      width: 48px;
      height: 72px;
      position: relative;
      transform: scale(2.5);
      margin: 50px auto 40px;
      animation: endingSpin 2s linear infinite;
    }

    @keyframes endingSpin {
      0% { transform: scale(2.5) rotate(0deg); }
      25% { transform: scale(2.7) rotate(90deg); }
      50% { transform: scale(2.9) rotate(180deg); }
      75% { transform: scale(2.7) rotate(270deg); }
      100% { transform: scale(2.5) rotate(360deg); }
    }

    .ending-message {
      color: #ffd93d;
      font-size: 26px;
      text-align: center;
      text-shadow: 3px 3px 0 #000;
      animation: endingFade 1s ease-out 0.5s both;
      padding: 0 15px;
    }

    .ending-submessage {
      color: #fff;
      font-size: 14px;
      margin-top: 20px;
      text-align: center;
      line-height: 1.7;
      animation: endingFade 1s ease-out 1.5s both;
      padding: 0 15px;
    }

    @keyframes endingFade {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .ending-restart {
      margin-top: 30px;
      background: #ffd93d;
      color: #000;
      border: none;
      padding: 15px 40px;
      font-family: 'DotGothic16', sans-serif;
      font-size: 16px;
      cursor: pointer;
      animation: endingFade 1s ease-out 2.5s both;
      border-radius: 5px;
      min-height: 44px;
    }

    .ending-restart:active {
      transform: scale(0.95);
      background: #fff;
    }

    /* „Çπ„Éû„ÉõÂêë„Åë„Ç®„É≥„Éá„Ç£„É≥„Ç∞ */
    @media screen and (max-width: 480px) {
      .ending-frisk {
        transform: scale(2);
        margin: 40px auto 30px;
      }
      
      @keyframes endingSpin {
        0% { transform: scale(2) rotate(0deg); }
        25% { transform: scale(2.2) rotate(90deg); }
        50% { transform: scale(2.4) rotate(180deg); }
        75% { transform: scale(2.2) rotate(270deg); }
        100% { transform: scale(2) rotate(360deg); }
      }
      
      .ending-message {
        font-size: 20px;
      }
      
      .ending-submessage {
        font-size: 12px;
        margin-top: 15px;
      }
      
      .ending-restart {
        margin-top: 25px;
        padding: 12px 30px;
        font-size: 14px;
      }
    }

    /* BGM„Ç≥„É≥„Éà„É≠„Éº„É´ */
    .bgm-control {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 250;
    }

    .bgm-btn {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #ffd93d;
      color: #ffd93d;
      padding: 8px 15px;
      font-family: 'DotGothic16', sans-serif;
      font-size: 12px;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.2s;
    }

    .bgm-btn:active {
      background: #ffd93d;
      color: #000;
    }

    .bgm-btn.playing {
      background: rgba(255, 217, 61, 0.3);
    }

    /* BGMÈñãÂßã„Éó„É≠„É≥„Éó„Éà */
    .bgm-prompt {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 600;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 1;
      transition: opacity 0.5s;
    }

    .bgm-prompt.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .bgm-prompt-content {
      text-align: center;
    }

    .bgm-prompt-title {
      color: #ffd93d;
      font-size: 28px;
      margin-bottom: 20px;
      text-shadow: 2px 2px 0 #000;
    }

    .bgm-prompt-frisk {
      width: 48px;
      height: 72px;
      position: relative;
      transform: scale(2);
      margin: 30px auto;
      animation: horseIdle 0.5s ease-in-out infinite alternate;
    }

    @keyframes horseIdle {
      0% { transform: scale(2) translateY(0); }
      100% { transform: scale(2) translateY(-5px); }
    }

    .bgm-prompt-text {
      color: #fff;
      font-size: 14px;
      margin-bottom: 30px;
    }

    .bgm-prompt-btn {
      background: #ffd93d;
      border: none;
      color: #000;
      padding: 15px 40px;
      font-family: 'DotGothic16', sans-serif;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin: 8px;
      transition: transform 0.1s;
      min-height: 44px;
    }

    .bgm-prompt-btn:active {
      transform: scale(0.95);
    }

    .bgm-prompt-btn.secondary {
      background: #333;
      color: #fff;
      border: 2px solid #666;
    }

    /* „Çπ„Éû„ÉõÂêë„ÅëBGM„Éó„É≠„É≥„Éó„Éà */
    @media screen and (max-width: 480px) {
      .bgm-prompt-title {
        font-size: 22px;
        margin-bottom: 15px;
      }
      
      .bgm-prompt-frisk {
        transform: scale(1.5);
        margin: 20px auto;
      }
      
      .bgm-prompt-text {
        font-size: 12px;
        margin-bottom: 20px;
      }
      
      .bgm-prompt-btn {
        padding: 12px 30px;
        font-size: 14px;
        margin: 5px;
      }
    }

    /* „ÉÅ„É•„Éº„Éà„É™„Ç¢„É´„Ç™„Éº„Éê„Éº„É¨„Ç§ */
    .tutorial-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 550;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 1;
      transition: opacity 0.5s;
    }

    .tutorial-overlay.active {
      display: flex;
    }

    .tutorial-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .tutorial-content {
      text-align: center;
      max-width: 90%;
    }

    .tutorial-step {
      display: none;
      animation: tutorialFade 0.5s ease-out;
    }

    .tutorial-step.active {
      display: block;
    }

    @keyframes tutorialFade {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* „Çπ„ÉÜ„ÉÉ„Éó1: ‰∏ª‰∫∫ÂÖ¨Á¥π‰ªã - „Éï„É™„Çπ„ÇØÈ¢® */
    .tutorial-frisk-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .tutorial-frisk {
      width: 48px;
      height: 72px;
      position: relative;
      transform: scale(2.5);
      margin: 40px;
      filter: drop-shadow(0 0 20px #ffd93d) drop-shadow(0 0 40px #ffd93d);
      animation: tutorialBounce 0.5s ease-in-out infinite alternate;
    }

    @keyframes tutorialBounce {
      0% { transform: scale(2.5) translateY(0); }
      100% { transform: scale(2.5) translateY(-8px); }
    }

    .tutorial-title {
      color: #ffd93d;
      font-size: 28px;
      margin-bottom: 15px;
      text-shadow: 2px 2px 0 #000;
    }

    .tutorial-text {
      color: #fff;
      font-size: 16px;
      line-height: 1.8;
      margin-bottom: 25px;
    }

    /* „Çπ„ÉÜ„ÉÉ„Éó2: Êìç‰ΩúË™¨Êòé */
    .tutorial-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      margin: 30px 0;
    }

    .tutorial-tap-area {
      width: 120px;
      height: 150px;
      border: 3px dashed #ffd93d;
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(255, 217, 61, 0.1);
    }

    .tutorial-arrow {
      font-size: 50px;
      color: #ffd93d;
      animation: tutorialArrow 0.8s ease-in-out infinite;
    }

    .tutorial-arrow.left {
      animation-name: tutorialArrowLeft;
    }

    .tutorial-arrow.right {
      animation-name: tutorialArrowRight;
    }

    @keyframes tutorialArrowLeft {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(-10px); }
    }

    @keyframes tutorialArrowRight {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(10px); }
    }

    .tutorial-tap-label {
      color: #fff;
      font-size: 12px;
      margin-top: 10px;
    }

    .tutorial-frisk-small {
      width: 32px;
      height: 48px;
      position: relative;
      transform: scale(1.2);
    }

    .tutorial-btn {
      background: #ffd93d;
      border: none;
      color: #000;
      padding: 15px 50px;
      font-family: 'DotGothic16', sans-serif;
      font-size: 18px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 20px;
      transition: transform 0.1s;
    }

    .tutorial-btn:active {
      transform: scale(0.95);
      background: #fff;
    }

    /* „Çπ„Éû„ÉõÂêë„Åë„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´ */
    @media screen and (max-width: 480px) {
      .tutorial-frisk {
        transform: scale(2);
        margin: 30px;
      }
      
      @keyframes tutorialBounce {
        0% { transform: scale(2) translateY(0); }
        100% { transform: scale(2) translateY(-8px); }
      }
      
      .tutorial-title {
        font-size: 22px;
      }
      
      .tutorial-text {
        font-size: 14px;
      }
      
      .tutorial-controls {
        gap: 20px;
      }
      
      .tutorial-tap-area {
        width: 100px;
        height: 120px;
      }
      
      .tutorial-arrow {
        font-size: 40px;
      }
      
      .tutorial-tap-label {
        font-size: 10px;
      }
      
      .tutorial-btn {
        padding: 12px 40px;
        font-size: 16px;
      }
    }

    /* YouTubeÂüã„ÇÅËæº„Åø„É¢„Éº„ÉÄ„É´ */
    .video-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 700;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .video-modal.active {
      display: flex;
    }

    .video-modal-header {
      color: #ffd93d;
      font-size: 18px;
      margin-bottom: 15px;
      text-align: center;
    }

    .video-container {
      width: 100%;
      max-width: 800px;
      aspect-ratio: 16 / 9;
      background: #000;
      border: 4px solid #ffd93d;
      border-radius: 8px;
      overflow: hidden;
    }

    .video-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Â§ß„Åç„ÅÑÂãïÁîª„É¢„Éº„ÉÄ„É´Ôºà„Ç≠„Çø„É§„ÉûËã±Ë™ûËß£Ë™¨Áî®Ôºâ */
    .video-modal.large .video-container {
      max-width: 95vw;
      max-height: 80vh;
      width: 95vw;
      height: 80vh;
      aspect-ratio: auto;
    }

    .video-modal.large .video-modal-header {
      font-size: 22px;
      margin-bottom: 10px;
    }

    .video-close-btn {
      margin-top: 15px;
      background: #ffd93d;
      border: none;
      color: #000;
      padding: 12px 30px;
      font-family: 'DotGothic16', sans-serif;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
      min-height: 44px;
    }

    .video-close-btn:active {
      transform: scale(0.95);
      background: #fff;
    }

    .video-modal.large .video-close-btn {
      margin-top: 10px;
      padding: 15px 40px;
      font-size: 16px;
    }

    /* „Ç∑„Éß„Éº„ÉàÂãïÁîªÁî®ÔºàÁ∏¶Èï∑Ôºâ */
    .video-modal.shorts .video-container {
      max-width: 350px;
      max-height: 80vh;
      width: 350px;
      height: 622px;
      aspect-ratio: 9 / 16;
    }

    .video-modal.shorts .video-modal-header {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .video-modal.shorts .video-close-btn {
      margin-top: 10px;
      padding: 12px 35px;
      font-size: 14px;
    }

    /* „Çπ„Éû„ÉõÂêë„ÅëÂãïÁîª„É¢„Éº„ÉÄ„É´ */
    @media screen and (max-width: 480px) {
      .video-modal {
        padding: 10px;
      }
      
      .video-modal-header {
        font-size: 14px;
        margin-bottom: 10px;
      }
      
      .video-container {
        border-width: 2px;
      }
      
      .video-close-btn {
        padding: 10px 25px;
        font-size: 12px;
      }
      
      .video-modal.large .video-container {
        max-width: 100vw;
        width: 100%;
        height: 60vh;
      }
      
      .video-modal.large .video-modal-header {
        font-size: 16px;
      }
      
      .video-modal.large .video-close-btn {
        padding: 12px 30px;
        font-size: 14px;
      }
      
      .video-modal.shorts .video-container {
        max-width: 280px;
        width: 280px;
        height: 498px;
      }
      
      .video-modal.shorts .video-modal-header {
        font-size: 14px;
      }
    }

    /* Â§ñÈÉ®„Çµ„Ç§„ÉàÂüã„ÇÅËæº„Åø„É¢„Éº„ÉÄ„É´ */
    .site-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 700;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 5px;
    }

    .site-modal.active {
      display: flex;
    }

    .site-modal-header {
      color: #ffd93d;
      font-size: 16px;
      margin-bottom: 5px;
      text-align: center;
      flex-shrink: 0;
    }

    .site-container {
      width: 100%;
      flex: 1;
      background: #fff;
      border: 3px solid #ffd93d;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    /* iframe„Çí„Çπ„Ç±„Éº„É™„É≥„Ç∞„Åó„Å¶ÂÖ®‰ΩìË°®Á§∫ */
    .site-container iframe {
      width: 166%;
      height: 166%;
      border: none;
      transform: scale(0.6);
      transform-origin: top left;
      -webkit-touch-callout: none !important;
    }

    .site-close-btn {
      margin-top: 5px;
      background: #ffd93d;
      border: none;
      color: #000;
      padding: 12px 40px;
      font-family: 'DotGothic16', sans-serif;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
      flex-shrink: 0;
      min-height: 44px;
    }

    .site-close-btn:active {
      transform: scale(0.95);
      background: #fff;
    }

    /* „Çπ„Éû„ÉõÂêë„ÅëÂ§ñÈÉ®„Çµ„Ç§„Éà„É¢„Éº„ÉÄ„É´ */
    @media screen and (max-width: 480px) {
      .site-modal {
        padding: 3px;
      }
      
      .site-modal-header {
        font-size: 12px;
        margin-bottom: 3px;
      }
      
      .site-container {
        border-width: 2px;
        height: calc(100vh - 80px);
      }
      
      .site-container iframe {
        width: 150%;
        height: 150%;
        transform: scale(0.67);
      }
      
      .site-close-btn {
        padding: 10px 25px;
        font-size: 12px;
        margin-top: 3px;
      }
    }
  </style>
</head>
<body>
  <!-- BGM -->
  <audio id="bgm" loop>
    <source src="bgm2.mp3" type="audio/mpeg">
  </audio>

  <!-- „Çª„É™„ÉïÂäπÊûúÈü≥ -->
  <audio id="dialogSound">
    <source src="dialog.mp3" type="audio/mpeg">
  </audio>

  <!-- BGM„Ç≥„É≥„Éà„É≠„Éº„É´ -->
  <div class="bgm-control" id="bgmControl">
    <button class="bgm-btn" id="bgmBtn" onclick="toggleBGM()">üîá BGM</button>
  </div>

  <!-- ÊòüÁ©∫ -->
  <div class="stars" id="stars"></div>

  <!-- Èõ™ -->
  <div class="snowflakes" id="snowflakes"></div>

  <!-- „Çø„ÉÉ„Éó„Ç®„É™„Ç¢ -->
  <div class="tap-area left" id="tapLeft">
    <div class="tap-indicator">‚óÄ</div>
  </div>
  <div class="tap-area right" id="tapRight">
    <div class="tap-indicator">‚ñ∂</div>
  </div>

  <!-- „Ç§„Éô„É≥„Éà„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
  <div class="event-overlay" id="eventOverlay"></div>

  <div class="game-container">
    <!-- Â±±„ÄÖ -->
    <div class="mountains">
      <div class="mountain mountain-1"></div>
      <div class="mountain mountain-2"></div>
      <div class="mountain mountain-3"></div>
      <div class="mountain mountain-4"></div>
    </div>

    <!-- Êú®„ÄÖ -->
    <div class="tree t1">
      <div class="tree-snow"></div>
      <div class="tree-trunk"></div>
    </div>
    <div class="tree t2">
      <div class="tree-snow"></div>
      <div class="tree-trunk"></div>
    </div>

    <!-- Ë°óÁÅØ -->
    <div class="lamp-post l1">
      <div class="lamp-light"></div>
      <div class="lamp-pole"></div>
    </div>
    <div class="lamp-post l2">
      <div class="lamp-light"></div>
      <div class="lamp-pole"></div>
    </div>

    <!-- ÈñÄÊùæ -->
    <div class="kadomatsu k1">üéç</div>
    <div class="kadomatsu k2">üéç</div>

    <!-- Âú∞Èù¢ -->
    <div class="ground"></div>

    <!-- NPC: Super happy -->
    <div class="npc npc-kitataya" id="npcKitataya">
      <div class="kitataya-head">
        <div class="kitataya-hair"></div>
        <div class="kitataya-eyes">
          <div class="kitataya-eye"></div>
          <div class="kitataya-eye"></div>
        </div>
        <div class="kitataya-smile"></div>
      </div>
      <div class="kitataya-body">
        <div class="kitataya-tie"></div>
      </div>
      <div class="npc-name">Super happy</div>
    </div>

    <!-- NPC: „Ç≠„Çø„É§„Éû -->
    <div class="npc npc-kitayama" id="npcKitayama">
      <div class="kitayama-head">
        <div class="kitayama-hair"></div>
        <div class="kitayama-eyes">
          <div class="kitayama-eye"></div>
          <div class="kitayama-eye"></div>
        </div>
        <div class="kitayama-sparkle">‚ú®</div>
        <div class="kitayama-smirk"></div>
      </div>
      <div class="kitayama-body">
        <div class="kitayama-collar"></div>
      </div>
      <div class="kitayama-legs">
        <div class="kitayama-leg"></div>
        <div class="kitayama-leg"></div>
      </div>
      <div class="npc-name">„Ç≠„Çø„É§„Éû</div>
    </div>

    <!-- NPC: Mr.Mori -->
    <div class="npc npc-mori" id="npcMori">
      <div class="mori-head">
        <div class="mori-hair"></div>
        <div class="mori-eyes">
          <div class="mori-eye"></div>
          <div class="mori-eye"></div>
        </div>
        <div class="mori-smile"></div>
      </div>
      <div class="mori-body"></div>
      <div class="mori-legs">
        <div class="mori-leg"></div>
        <div class="mori-leg"></div>
      </div>
      <div class="npc-name">Mr.Mori</div>
    </div>

    <!-- Áî∫„ÅÆÂª∫Áâ© -->
    <div class="town">
      <!-- ÈÅéÂéªÂïèÈÅìÂ†¥ -->
      <div class="building dojo" id="buildingDojo">
        <div class="building-glow"></div>
        <div class="dojo-sign">ÈÅéÂéªÂïèÈÅìÂ†¥</div>
        <div class="dojo-roof"></div>
        <div class="dojo-body">
          <div class="dojo-window left"></div>
          <div class="dojo-window right"></div>
          <div class="dojo-door"></div>
        </div>
      </div>

      <!-- Á•ûÁ§æÔºàÊôÇ‰∫ãÂïèÈ°åÔºâ -->
      <div class="building shrine" id="buildingShrine">
        <div class="building-glow"></div>
        <div class="shrine-sign">ÊôÇ‰∫ãÂïèÈ°åÁ•ûÁ§æ</div>
        <div class="torii">
          <div class="torii-top"></div>
          <div class="torii-beam"></div>
          <div class="torii-pillar left"></div>
          <div class="torii-pillar right"></div>
        </div>
        <div class="shrine-roof"></div>
        <div class="shrine-body">
          <div class="shrine-lantern left"></div>
          <div class="shrine-lantern right"></div>
          <div class="shrine-door"></div>
        </div>
      </div>
    </div>

    <!-- „Éó„É¨„Ç§„É§„Éº -->
    <div class="player" id="player">
      <div class="frisk" id="frisk">
        <div class="frisk-hair"></div>
        <div class="frisk-face"></div>
        <div class="frisk-body"></div>
        <div class="frisk-arms"></div>
        <div class="frisk-legs"></div>
      </div>
    </div>
  </div>

  <!-- UI -->
  <div class="ui-overlay">
    <div class="title-box">
      <div class="year-badge">üê¥ 2026</div>
      <h1>Ê≠£ÊúàÁâπË®ì„ÅÆ„Åæ„Å°Èßø„Éù„É≠</h1>
      <div class="subtitle">„Äú ÂêàÊ†º„ÇíÁõÆÊåá„ÅôÂÜíÈô∫„Å∏ „Äú</div>
    </div>
    <div class="controls-hint">
      <p>üì± ÁîªÈù¢„ÅÆÂ∑¶Âè≥„Çí„Çø„ÉÉ„Éó„ÅßÁßªÂãï</p>
      <p>üè† Âª∫Áâ©„ÇÑ„Ç≠„É£„É©„Çí„Çø„ÉÉ„Éó„Åß‰ºöË©±</p>
    </div>
  </div>

  <!-- „Ç§„Éô„É≥„Éà„ÉÄ„Ç§„Ç¢„É≠„Ç∞ -->
  <div class="event-dialog" id="eventDialog">
    <div class="event-dialog-header">
      <span class="speaker-icon" id="speakerIcon">üòä</span>
      <span class="speaker-name" id="speakerName">???</span>
    </div>
    <div class="event-dialog-content">
      <p id="eventText"></p>
    </div>
    <div class="event-dialog-choices" id="eventChoices"></div>
  </div>

  <!-- YouTubeÂüã„ÇÅËæº„Åø„É¢„Éº„ÉÄ„É´ -->
  <div class="video-modal" id="videoModal">
    <div class="video-modal-header" id="videoModalTitle">üì∫ ÂãïÁîª„ÇíË¶ã„Çã</div>
    <div class="video-container">
      <iframe id="videoIframe" src="" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
    </div>
    <button class="video-close-btn" onclick="closeVideo()">‚úï Èñâ„Åò„Å¶ÈÄ≤„ÇÄ</button>
  </div>

  <!-- Â§ñÈÉ®„Çµ„Ç§„ÉàÂüã„ÇÅËæº„Åø„É¢„Éº„ÉÄ„É´ -->
  <div class="site-modal" id="siteModal">
    <div class="site-modal-header" id="siteModalTitle">üìù Â§ñÈÉ®„Çµ„Ç§„Éà</div>
    <div class="site-container">
      <iframe id="siteIframe" src=""></iframe>
    </div>
    <button class="site-close-btn" onclick="closeSite()">‚úï Èñâ„Åò„Å¶„Ç≤„Éº„É†„Å´Êàª„Çã</button>
  </div>

  <!-- BGMÈñãÂßã„Éó„É≠„É≥„Éó„Éà -->
  <div class="bgm-prompt" id="bgmPrompt">
    <div class="bgm-prompt-content">
      <div class="bgm-prompt-title">üéç Ê≠£ÊúàÁâπË®ì„ÅÆ„Åæ„Å°Èßø„Éù„É≠ üéç</div>
      <div class="bgm-prompt-frisk">
        <div class="frisk-hair"></div>
        <div class="frisk-face"></div>
        <div class="frisk-body"></div>
        <div class="frisk-arms"></div>
        <div class="frisk-legs"></div>
      </div>
      <div class="bgm-prompt-text">BGM„ÇíÂÜçÁîü„Åó„Åæ„Åô„ÅãÔºü</div>
      <button class="bgm-prompt-btn" onclick="startWithBGM()">üîä BGM„ÅÇ„Çä</button>
      <button class="bgm-prompt-btn secondary" onclick="startWithoutBGM()">üîá BGM„Å™„Åó</button>
    </div>
  </div>

  <!-- „ÉÅ„É•„Éº„Éà„É™„Ç¢„É´„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
  <div class="tutorial-overlay" id="tutorialOverlay">
    <div class="tutorial-content">
      <!-- „Çπ„ÉÜ„ÉÉ„Éó1: ‰∏ª‰∫∫ÂÖ¨Á¥π‰ªã -->
      <div class="tutorial-step active" id="tutorialStep1">
        <div class="tutorial-frisk-container">
          <div class="tutorial-frisk">
            <div class="frisk-hair"></div>
            <div class="frisk-face"></div>
            <div class="frisk-body"></div>
            <div class="frisk-arms"></div>
            <div class="frisk-legs"></div>
          </div>
        </div>
        <div class="tutorial-title">„Åì„Çå„Åå„Ç≠„Éü„Å†ÔºÅ</div>
        <p class="tutorial-text">
          „Ç≠„Éü„ÅØ„Åì„ÅÆÂ≠ê„Å®„Å™„Å£„Å¶<br>
          Ê≠£ÊúàÁâπË®ì„ÅÆ„Åæ„Å°Èßø„Éù„É≠„ÇíÂÜíÈô∫„Åô„Çã„ÅûÔºÅ
        </p>
        <button class="tutorial-btn" onclick="nextTutorialStep()">„Å§„Åé„Å∏ ‚Üí</button>
      </div>
      
      <!-- „Çπ„ÉÜ„ÉÉ„Éó2: Êìç‰ΩúË™¨Êòé -->
      <div class="tutorial-step" id="tutorialStep2">
        <div class="tutorial-title">Êìç‰ΩúÊñπÊ≥ï</div>
        <p class="tutorial-text">ÁîªÈù¢„ÅÆÂ∑¶Âè≥„Çí„Çø„ÉÉ„Éó„Åó„Å¶ÁßªÂãï„Åó„Çà„ÅÜÔºÅ</p>
        <div class="tutorial-controls">
          <div class="tutorial-tap-area">
            <div class="tutorial-arrow left">üëà</div>
            <div class="tutorial-tap-label">Â∑¶ÂçäÂàÜ„Çø„ÉÉ„Éó</div>
          </div>
          <div class="tutorial-frisk-small">
            <div class="frisk-hair"></div>
            <div class="frisk-face"></div>
            <div class="frisk-body"></div>
            <div class="frisk-arms"></div>
            <div class="frisk-legs"></div>
          </div>
          <div class="tutorial-tap-area">
            <div class="tutorial-arrow right">üëâ</div>
            <div class="tutorial-tap-label">Âè≥ÂçäÂàÜ„Çø„ÉÉ„Éó</div>
          </div>
        </div>
        <p class="tutorial-text" style="font-size: 14px; color: #ffd93d;">
          ‚Üê Â∑¶„Å´ÈÄ≤„Çì„Åß„Ç¥„Éº„É´„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ
        </p>
        <button class="tutorial-btn" onclick="startGame()">„Ç≤„Éº„É†„Çπ„Çø„Éº„ÉàÔºÅ</button>
      </div>
    </div>
  </div>

  <!-- „Ç®„É≥„Éá„Ç£„É≥„Ç∞ -->
  <div class="ending-overlay" id="endingOverlay">
    <div class="ending-frisk">
      <div class="frisk-hair"></div>
      <div class="frisk-face"></div>
      <div class="frisk-body"></div>
      <div class="frisk-arms"></div>
      <div class="frisk-legs"></div>
    </div>
    <div class="ending-message">üéç 2026Âπ¥„ÇÇÈ†ëÂºµ„Çç„ÅÜÔºÅ üéç</div>
    <div class="ending-submessage">
      Ê≠£ÊúàÁâπË®ì„ÄÅ„ÅäÁñ≤„Çå„Åï„Åæ„Åß„Åó„ÅüÔºÅ<br>
      ÂêàÊ†ºÁõÆÊåá„Åó„Å¶ÈßÜ„ÅëÊäú„Åë„Çà„ÅÜÔºÅ<br><br>
      üå∏ Êò•„ÅØ„ÇÇ„ÅÜ„Åô„Åê„Åù„Åì„Å†ÔºÅ üå∏
    </div>
    <button class="ending-restart" onclick="location.reload()">üîÑ „ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊúÄÂàù„Åã„Çâ</button>
  </div>

  <script>
    // ========== „Ç≤„Éº„É†Áä∂ÊÖãÁÆ°ÁêÜ ==========
    // „Ç§„Éô„É≥„Éà„Éà„É™„Ç¨„Éº‰ΩçÁΩÆÔºàÂè≥„Åã„ÇâÂ∑¶„Å∏Ôºâ
    // 88% „Çπ„Çø„Éº„Éà
    // 72% Super happy
    // 55% Á•ûÁ§æ
    // 38% ÈÅìÂ†¥
    // 18% „Ç≠„Çø„É§„ÉûÁôªÂ†¥
    
    const gameState = {
      playerX: 88,
      canMove: false,
      // „Ç§„Éô„É≥„Éà„Éï„É©„Ç∞
      kitatayaTalked: false,      // Super happy„Å®Ë©±„Åó„Åü
      shrineTalked: false,        // Á•ûÁ§æ„ÅßË©±„Åó„Åü
      dojoTalked: false,          // ÈÅìÂ†¥„ÅßË©±„Åó„Åü
      kitayamaAppeared: false,    // „Ç≠„Çø„É§„ÉûÁôªÂ†¥Ê∏à„Åø
      kitayamaEventDone: false,   // „Ç≠„Çø„É§„Éû„Ç§„Éô„É≥„ÉàÂÆå‰∫Ü
      englishTestDone: false      // Ëã±Ë™û„ÉÜ„Çπ„ÉàÁµÇ„Çè„Å£„ÅüË®≠ÂÆö
    };

    // „Éà„É™„Ç¨„Éº‰ΩçÁΩÆ
    const TRIGGER = {
      KITATAYA: 72,
      SHRINE: 65,
      DOJO: 38,
      KITAYAMA: 18
    };

    // ========== DOMË¶ÅÁ¥† ==========
    const player = document.getElementById('player');
    const frisk = document.getElementById('frisk');
    const eventOverlay = document.getElementById('eventOverlay');
    const eventDialog = document.getElementById('eventDialog');
    const npcKitayama = document.getElementById('npcKitayama');
    const endingOverlay = document.getElementById('endingOverlay');

    let walkTimeout = null;
    let moveInterval = null;

    // ========== „Éó„É¨„Ç§„É§„ÉºÁßªÂãï ==========
    function movePlayer(direction) {
      if (!gameState.canMove) return;

      const step = 2;
      const oldX = gameState.playerX;

      if (direction === 'left') {
        const newX = gameState.playerX - step;
        
        // ÂêÑ„Éà„É™„Ç¨„Éº„Éù„Ç§„É≥„Éà„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÔºàÂ∑¶„Å´ÈÄ≤„ÇÄÊôÇÔºâ
        // Super happy
        if (!gameState.kitatayaTalked && oldX > TRIGGER.KITATAYA && newX <= TRIGGER.KITATAYA) {
          triggerKitatayaEvent();
          return;
        }
        // Á•ûÁ§æ
        if (!gameState.shrineTalked && oldX > TRIGGER.SHRINE && newX <= TRIGGER.SHRINE) {
          triggerShrineEvent();
          return;
        }
        // ÈÅìÂ†¥
        if (!gameState.dojoTalked && oldX > TRIGGER.DOJO && newX <= TRIGGER.DOJO) {
          triggerDojoEvent();
          return;
        }
        // „Ç≠„Çø„É§„Éû
        if (!gameState.kitayamaAppeared && oldX > TRIGGER.KITAYAMA && newX <= TRIGGER.KITAYAMA) {
          triggerKitayamaAppearance();
          return;
        }

        if (newX >= 8) {
          gameState.playerX = newX;
          frisk.classList.add('flip');
        }
      } else if (direction === 'right') {
        if (gameState.playerX < 92) {
          gameState.playerX += step;
          frisk.classList.remove('flip');
        }
      }

      player.style.left = gameState.playerX + '%';
      frisk.classList.add('walking');
      clearTimeout(walkTimeout);
      walkTimeout = setTimeout(() => frisk.classList.remove('walking'), 200);
    }

    // ========== „Çø„ÉÉ„ÉóÊìç‰Ωú ==========
    function startMove(direction) {
      movePlayer(direction);
      moveInterval = setInterval(() => movePlayer(direction), 80);
    }

    function stopMove() {
      clearInterval(moveInterval);
      clearInterval(autoMoveInterval);
      autoMoveInterval = null;
      frisk.classList.remove('walking');
    }

    // Âª∫Áâ©„Å∏„ÅÆËá™ÂãïÁßªÂãï
    let autoMoveInterval = null;
    
    function moveToBuilding(targetX) {
      if (!gameState.canMove) return;
      
      // ÁèæÂú®‰ΩçÁΩÆ„Å®ÁõÆÊ®ô‰ΩçÁΩÆ„ÇíÊØîËºÉ
      const currentX = gameState.playerX;
      if (Math.abs(currentX - targetX) < 2) return; // „Åô„Åß„Å´Ëøë„ÅÑ
      
      // ÁßªÂãïÊñπÂêë„ÇíÊ±∫ÂÆö
      const direction = currentX > targetX ? 'left' : 'right';
      
      // Ëá™ÂãïÁßªÂãïÈñãÂßã
      stopMove(); // Êó¢Â≠ò„ÅÆÁßªÂãï„ÇíÂÅúÊ≠¢
      
      autoMoveInterval = setInterval(() => {
        if (!gameState.canMove) {
          // „Ç§„Éô„É≥„ÉàÁô∫Áîü„ÅßÁßªÂãï‰∏çÂèØ„Å´„Å™„Å£„Åü„ÇâÂÅúÊ≠¢
          stopMove();
          return;
        }
        
        movePlayer(direction);
        
        // ÁõÆÊ®ôÂú∞ÁÇπ„Å´Âà∞ÈÅî„Åó„Åü„Åã„ÄÅÈÄö„ÇäÈÅé„Åé„Åü„ÇâÂÅúÊ≠¢
        if (direction === 'left' && gameState.playerX <= targetX) {
          stopMove();
        } else if (direction === 'right' && gameState.playerX >= targetX) {
          stopMove();
        }
      }, 80);
    }

    document.getElementById('tapLeft').addEventListener('touchstart', (e) => {
      e.preventDefault();
      stopMove(); // Ëá™ÂãïÁßªÂãï„ÇíÂÅúÊ≠¢
      startMove('left');
    });
    document.getElementById('tapLeft').addEventListener('touchend', stopMove);
    document.getElementById('tapLeft').addEventListener('touchcancel', stopMove);

    document.getElementById('tapRight').addEventListener('touchstart', (e) => {
      e.preventDefault();
      stopMove(); // Ëá™ÂãïÁßªÂãï„ÇíÂÅúÊ≠¢
      startMove('right');
    });
    document.getElementById('tapRight').addEventListener('touchend', stopMove);
    document.getElementById('tapRight').addEventListener('touchcancel', stopMove);

    // „Éû„Ç¶„ÇπÊìç‰ΩúÔºàPCÁî®Ôºâ
    document.getElementById('tapLeft').addEventListener('mousedown', () => { stopMove(); startMove('left'); });
    document.getElementById('tapLeft').addEventListener('mouseup', stopMove);
    document.getElementById('tapLeft').addEventListener('mouseleave', stopMove);
    document.getElementById('tapRight').addEventListener('mousedown', () => { stopMove(); startMove('right'); });
    document.getElementById('tapRight').addEventListener('mouseup', stopMove);
    document.getElementById('tapRight').addEventListener('mouseleave', stopMove);

    // Âª∫Áâ©„Çø„ÉÉ„Éó - „Åù„ÅÆ‰ΩçÁΩÆ„Åæ„ÅßÁßªÂãï
    document.getElementById('buildingDojo').addEventListener('click', (e) => {
      e.stopPropagation();
      moveToBuilding(38); // ÈÅìÂ†¥„ÅÆ‰ΩçÁΩÆ
    });

    document.getElementById('buildingShrine').addEventListener('click', (e) => {
      e.stopPropagation();
      moveToBuilding(55); // Á•ûÁ§æ„ÅÆ‰ΩçÁΩÆ
    });

    document.getElementById('npcKitataya').addEventListener('click', (e) => {
      e.stopPropagation();
      if (gameState.canMove && !gameState.kitatayaTalked) triggerKitatayaEvent();
    });

    // ========== Super happy „Ç§„Éô„É≥„Éà ==========
    function triggerKitatayaEvent() {
      gameState.canMove = false;
      stopMove();
      showExclamation(document.getElementById('npcKitataya'));

      setTimeout(() => {
        showEventDialog({
          speaker: 'Super happy',
          icon: 'üòä',
          text: '„Å°„Çá„Å£„Å®ÂæÖ„Å£„Å¶ÔºÅ\n\n„ÅÇ„Åë„Åæ„Åó„Å¶„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅÔºÅ\nÊñ∞Âπ¥„ÅÆ„ÅîÊå®Êã∂„ÄÅËÅû„ÅÑ„Å¶„ÅÑ„Åã„Å™„ÅÑÔºü',
          choices: [
            { text: 'ËÅû„Åè', action: () => kitatayaGreeting() },
            { text: 'ËÅû„Åã„Å™„ÅÑ', action: () => kitatayaForceChoice(), canChange: true }
          ]
        });
      }, 500);
    }

    function kitatayaForceChoice() {
      const noBtn = document.querySelector('.choice-btn.no-btn');
      if (noBtn) {
        noBtn.classList.add('changing');
        setTimeout(() => {
          noBtn.textContent = 'ËÅû„Åè';
          noBtn.classList.remove('changing');
          noBtn.classList.add('forced');
          noBtn.onclick = () => kitatayaGreeting();
        }, 400);
      }
    }

    function kitatayaGreeting() {
      showEventDialog({
        speaker: 'Super happy',
        icon: 'üéâ',
        text: '„ÇÑ„Å£„Åü„ÉºÔºÅËÅû„ÅÑ„Å¶„Åè„Çå„Çã„Çì„Å†ÔºÅ\n\nüéç „ÅÇ„Åë„Åæ„Åó„Å¶„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ üéç\n\n‰ªäÂπ¥„ÇÇÁöÜ„Åï„Çì„Å´„Å®„Å£„Å¶\nSuper happy „Å™‰∏ÄÂπ¥„Å´„Å™„Çä„Åæ„Åô„Çà„ÅÜ„Å´ÔºÅ\n\nÂèóÈ®ìÁîü„ÅÆÁöÜ„Åï„Çì„ÄÅÊúÄÂæå„Åæ„ÅßË´¶„ÇÅ„Åö„Å´\nÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜÔºÅÔºÅ\n\nüì∫ Êñ∞Âπ¥„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏ÂãïÁîª„ÇÇË¶ã„Å¶„ÅÑ„Å£„Å¶„Å≠ÔºÅ',
        choices: [{ text: 'ÂãïÁîª„ÇíË¶ã„ÇãÔºÅ', action: () => {
          gameState.kitatayaTalked = true;
          gameState.canMove = true;
          closeEventDialog();
          // Âüã„ÇÅËæº„ÅøÂãïÁîª„ÇíË°®Á§∫
          openVideo(VIDEO_IDS.superHappy, 'üéâ Super happy Êñ∞Âπ¥„É°„ÉÉ„Çª„Éº„Ç∏', null);
        }}]
      });
    }

    // ========== Á•ûÁ§æÔºàÊôÇ‰∫ãÂïèÈ°åÔºâ„Ç§„Éô„É≥„Éà ==========
    function triggerShrineEvent() {
      gameState.canMove = false;
      stopMove();
      showExclamation(document.getElementById('buildingShrine'));

      setTimeout(() => {
        showEventDialog({
          speaker: 'Á•û‰∏ª',
          icon: '‚õ©Ô∏è',
          text: '„Åä„Åä„ÄÅÂèÇÊãùËÄÖ„Çà„ÄÇ\n\n„Åì„Åì„ÅØÊôÇ‰∫ãÂïèÈ°åÁ•ûÁ§æ„Åò„ÇÉ„ÄÇ\n\n2025Âπ¥„ÅÆÊôÇ‰∫ãÂïèÈ°å„ÇØ„Ç§„Ç∫„Å´\n„ÉÅ„É£„É¨„É≥„Ç∏„Åó„Å¶„ÅÑ„Åã„Å¨„ÅãÔºü\n\n‚ùì ÂÖ®40Âïè\n‚è±Ô∏è Á¥Ñ15ÂàÜ\n\nÊôÇ‰∫ã„ÇíÁü•„ÇãËÄÖ„Å´„ÄÅÂêàÊ†º„ÅÆÁ•ûÊßò„ÅØÂæÆÁ¨ë„ÇÄ„ÅûÔºÅ\n\nüö® Êú≠ÂπåÊó•Â§ß‰∏≠ÂèóÈ®ìËÄÖ„ÅØÂøÖÈ†à„Åò„ÇÉÔºÅ',
          choices: [
            { text: '„ÇÑ„Å£„Å¶„ÅÑ„Åè', action: () => {
              gameState.shrineTalked = true;
              gameState.canMove = true;
              closeEventDialog();
              // ÂÆüÈöõ„ÅÆ„É™„É≥„ÇØ„Å´Â§âÊõ¥
              openSite('https://yoshimarch.github.io/2026geisyunworldnews/', '‚õ©Ô∏è ÊôÇ‰∫ãÂïèÈ°å„ÇØ„Ç§„Ç∫ 2025');
            }},
            { text: '„ÇÑ„Çâ„Å™„ÅÑ', action: () => {
              showEventDialog({
                speaker: 'Á•û‰∏ª',
                icon: '‚õ©Ô∏è',
                text: '„Åù„ÅÜ„Åã„ÄÅ„Åæ„ÅüÊ∞ó„ÅåÂêë„ÅÑ„Åü„ÇâÊù•„Çã„Åå„Çà„ÅÑ„ÄÇ\n\nÂêàÊ†ºÁ•àÈ°ò„ÄÅ„Åó„Å¶„Åä„Åè„ÅûÔºÅ üôè',
                choices: [{ text: 'ÂÖà„Å´ÈÄ≤„ÇÄ', action: () => {
                  gameState.shrineTalked = true;
                  gameState.canMove = true;
                  closeEventDialog();
                }}]
              });
            }}
          ]
        });
      }, 500);
    }

    // ========== ÈÅéÂéªÂïèÈÅìÂ†¥„Ç§„Éô„É≥„Éà ==========
    function triggerDojoEvent() {
      gameState.canMove = false;
      stopMove();
      showExclamation(document.getElementById('buildingDojo'));

      setTimeout(() => {
        showEventDialog({
          speaker: 'ÈÅìÂ†¥Èï∑',
          icon: 'ü•ã',
          text: '„Åù„Åì„ÅÆËÄÖ„ÄÅÂæÖ„Åü„Çå„ÇàÔºÅ\n\n„Åì„Åì„ÅØÈÅéÂéªÂïèÈÅìÂ†¥„Åò„ÇÉ„ÄÇ\n\nÊ≠£Á≠îÁéá„ÅÆÈõÜË®à„Å´ÂçîÂäõ„Åó„Å¶„Åè„Çå„Å¨„ÅãÔºü\n\nÂêõ„ÅÆÁµêÊûú„ÇíÂÖ•Âäõ„Åó„Å¶„ÇÇ„Çâ„Åà„Çã„Å®„ÄÅ\nÂÖ®‰Ωì„ÅÆÂÇæÂêë„ÅåË¶ã„Åà„Å¶ÁöÜ„ÅÆÂΩπ„Å´Á´ã„Å§„ÅÆ„Åò„ÇÉ„ÄÇ',
          choices: [
            { text: 'ÂçîÂäõ„Åô„Çã', action: dojoCooperateWarning },
            { text: '„ÇÑ„Çâ„Å™„ÅÑ', action: dojoDecline }
          ]
        });
      }, 500);
    }

    function dojoCooperateWarning() {
      showEventDialog({
        speaker: 'ÈÅìÂ†¥Èï∑',
        icon: 'ü•ã',
        text: '„Åä„Åä„ÄÅ„ÅÇ„Çä„Åå„Åü„ÅÑÔºÅ\n\n‚ö†Ô∏è „Åü„Å†„Åó„ÄÅ‰∏Ä„Å§Â§ß‰∫ã„Å™„Åì„Å®„Çí‰ºù„Åà„Å¶„Åä„Åè„ÄÇ\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n„ÄêÂøÖ„Åö„Éã„ÉÉ„ÇØ„Éç„Éº„É†„ÅßÂÖ•Âäõ„Åô„Çã„Åì„Å®„ÄÇ„Éë„Çπ„ÉØ„Éº„Éâ„ÅØ6ÊñáÂ≠ó‰ª•ÂÜÖ„ÅÆÂçäËßíËã±Êï∞„ÄÇ„É°„É¢„Çí„Å®„Å£„Å¶„Åä„Åè„ÄÇ„Äë\nÂÆüÂêç„ÅØÁµ∂ÂØæ„Å´ÂÖ•„Çå„Å¶„ÅØ„Å™„Çâ„Å¨„ÅûÔºÅ\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n„Éó„É©„Ç§„Éê„Ç∑„Éº„ÇíÂÆà„Çã„Åì„Å®„ÅåÂ§ßÂàá„Åò„ÇÉ„ÄÇ',
        choices: [
          { text: '„Çè„Åã„Å£„ÅüÔºÅÂÖ•Âäõ„Åô„Çã', action: () => {
            gameState.dojoTalked = true;
            gameState.englishTestDone = true;
            gameState.canMove = true;
            closeEventDialog();
            // ÂÆüÈöõ„ÅÆ„É™„É≥„ÇØ„Å´Â§âÊõ¥
            openSite('https://text-order-project.web.app/', 'ü•ã ÈÅéÂéªÂïèÁµêÊûúÂÖ•Âäõ');
          }},
          { text: '„ÇÑ„Å£„Å±„Çä„ÇÑ„ÇÅ„Çã', action: dojoDecline }
        ]
      });
    }

    function dojoDecline() {
      showEventDialog({
        speaker: 'ÈÅìÂ†¥Èï∑',
        icon: 'ü•ã',
        text: '„Åù„ÅÜ„Åã„ÄÅ„Åæ„ÅüÊ∞ó„ÅåÂêë„ÅÑ„Åü„ÇâÊù•„Çã„Åå„Çà„ÅÑ„ÄÇ\n\nÈÅéÂéªÂïèÊºîÁøí„ÄÅÈ†ëÂºµ„Çã„ÅÆ„Åò„ÇÉ„ÅûÔºÅ üí™',
        choices: [{ text: 'ÂÖà„Å´ÈÄ≤„ÇÄ', action: () => {
          gameState.dojoTalked = true;
          gameState.canMove = true;
          closeEventDialog();
        }}]
      });
    }

    // ========== „Ç≠„Çø„É§„Éû„Ç§„Éô„É≥„Éà ==========
    function triggerKitayamaAppearance() {
      gameState.kitayamaAppeared = true;
      gameState.canMove = false;
      stopMove();

      setTimeout(() => {
        npcKitayama.classList.add('appear');
        
        setTimeout(() => {
          showExclamation(npcKitayama);
        }, 700);

        setTimeout(() => {
          showEventDialog({
            speaker: '„Ç≠„Çø„É§„Éû',
            icon: '‚ú®',
            text: 'Oh...?\n\n„Åù„Åì„ÅÆÂêõ„ÄÅ„Å°„Çá„Å£„Å®ÂæÖ„Å°„Åü„Åæ„Åà„ÄÇ\n\nÁßÅ„ÅÆÂêç„ÅØ„Ç≠„Çø„É§„Éû...\n„Åì„ÅÆÁî∫‰∏ÄÁï™„ÅÆËã±Ë™ûË¨õÂ∏´„Åï„ÄÇ\n\n„Åµ„Åµ„ÄÅÂêõ„ÅÆ„Åù„ÅÆÁõÆ...\nËã±Ë™û„ÅÆÂÆüÂäõ„ÇíÈ´ò„ÇÅ„Åü„ÅÑ„Å®Ë®Ä„Å£„Å¶„ÅÑ„Çã„Å≠Ôºü',
            choices: [{ text: '...„Åà„Å£', action: kitayamaAskTest }]
          });
        }, 1400);
      }, 300);
    }

    function kitayamaAskTest() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'ü§î',
        text: '„Åù„ÅÆÂâç„Å´‰∏Ä„Å§ËÅû„Åã„Åõ„Å¶„ÇÇ„Çâ„Åä„ÅÜ„ÄÇ\n\nËã±Ë™û„ÅÆ„ÉÜ„Çπ„Éà„Åæ„Åß...\nÈÅéÂéªÂïè„ÅØÁµÇ„Çè„Å£„Å¶„ÅÑ„Çã„Åã„ÅÑÔºü',
        choices: [
          { text: '„ÅØ„ÅÑ„ÄÅÁµÇ„Çè„Çä„Åæ„Åó„Åü', action: kitayamaProposal },
          { text: '„ÅÑ„ÅÑ„Åà„ÄÅ„Åæ„Å†„Åß„Åô', action: kitayamaReject },
          { text: '„ÅÑ„ÇÑ„ÄÅÁßÅ„ÅØÂ∞è6„Åß„Åô', action: kitayamaForElementary }
        ]
      });
    }

    function kitayamaReject() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üòè',
        text: '„Åµ„Åµ...\n\n„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„ÅÑ„Å™„ÅÑ„ÅÆ„Åã„ÅÑÔºü\n\n„Åù„Çå„Åß„ÅØ„Åì„Åì„ÇíÈÄö„Åô„Çè„Åë„Å´„ÅØ„ÅÑ„Åã„Å™„ÅÑ„Å™„ÄÇ\n\n„Åæ„Åö„ÅØÈÅéÂéªÂïè„ÇíÁµÇ„Çè„Çâ„Åõ„Å¶„Åè„Çã„Çì„Å†„ÄÇ\nË©±„ÅØ„Åù„Çå„Åã„Çâ„Åï„ÄÇ\n\n‚ú® Stay focused ‚ú®',
        choices: [{ text: '„Çè„Åã„Çä„Åæ„Åó„Åü...', action: () => {
          gameState.kitayamaAppeared = false;
          npcKitayama.classList.remove('appear');
          gameState.canMove = true;
          closeEventDialog();
        }}]
      });
    }

    // ========== Â∞è6Âêë„ÅëÁâπÂà•„É´„Éº„Éà ==========
    function kitayamaForElementary() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: '‚ú®',
        text: '„Åä„Åä...Â∞è6„Åã„ÅÑÔºü\n\n„Å§„Åæ„Çä‰∏≠Â≠¶ÂèóÈ®ìÁîü„Å®„ÅÑ„ÅÜ„Çè„Åë„Å†„ÄÇ\n\n„Åµ„Åµ„ÄÅ„Åù„Çå„Å™„ÇâË©±„ÅØÂà•„Å†„ÄÇ\n\n„Å®„Åì„Çç„ÅßÂêõ...\nÊú≠ÂπåÊó•Â§ß‰∏≠„ÇíÂèó„Åë„Çã„ÅÆ„Åã„ÅÑÔºü',
        choices: [
          { text: '„ÅØ„ÅÑ', action: kitayamaIntroduceMori },
          { text: '„ÅÑ„ÅÑ„Åà', action: kitayamaElementaryMessage }
        ]
      });
    }

    // ========== Mr.Mori „É´„Éº„Éà ==========
    function kitayamaIntroduceMori() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üí°',
        text: 'Êú≠ÂπåÊó•Â§ß‰∏≠„ÅãÔºÅ\n\n„Åù„Çå„Å™„Çâ...\nÁßÅ„ÅÆÂèã‰∫∫„ÇíÁ¥π‰ªã„Åó„Çà„ÅÜ„ÄÇ\n\nÂΩº„ÅØÊú≠ÂπåÊó•Â§ß‰∏≠„ÅÆ„Åì„Å®„Çí\n„Çà„ÅèÁü•„Å£„Å¶„ÅÑ„ÇãÁî∑„Å†„ÄÇ\n\n„Åç„Å£„Å®Âêõ„ÅÆÂäõ„Å´„Å™„Çã„ÅØ„Åö„Åï„ÄÇ',
        choices: [{ text: 'Âèã‰∫∫...Ôºü', action: moriAppear }]
      });
    }

    function moriAppear() {
      // „Åæ„Åö„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÈñâ„Åò„Çã
      closeEventDialog();
      
      // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâMr.Mori„ÇíÁôªÂ†¥„Åï„Åõ„Çã
      setTimeout(() => {
        const npcMori = document.getElementById('npcMori');
        npcMori.classList.add('appear');
      }, 500);
      
      // Mr.Mori„Åå„Çπ„É©„Ç§„Éâ„Ç§„É≥„Åó„ÅüÂæå„Å´„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíË°®Á§∫
      setTimeout(() => {
        showEventDialog({
          speaker: 'Mr.Mori',
          icon: 'üë®‚Äçüè´',
          text: '„ÇÑ„ÅÇ„ÄÅÂàù„ÇÅ„Åæ„Åó„Å¶ÔºÅ\n\nÁßÅ„ÅØMr.Mori„ÄÇ\n„Ç≠„Çø„É§„Éû„ÅÆÂèã‰∫∫„Åï„ÄÇ\n\nÊú≠ÂπåÊó•Â§ß‰∏≠„ÇíÁõÆÊåá„Åó„Å¶„ÅÑ„Çã„Çì„Å†„Å£„Å¶Ôºü\nÁ¥†Êô¥„Çâ„Åó„ÅÑÂøó„Å†„Å≠ÔºÅ\n\nÁßÅ„ÅÆYouTubeÂãïÁîª„Åß\nÊú≠ÂπåÊó•Â§ß‰∏≠„ÅÆÂÖ•Ë©¶„Å´„Å§„ÅÑ„Å¶„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂá∫„Åó„Åü„Çì„Å†„ÄÇ\n\nË¶ã„Å¶„ÅÑ„Åè„Åã„ÅÑÔºü',
          choices: [
            { text: '„ÅØ„ÅÑÔºÅ', action: moriGoToYoutube }
          ]
        });
      }, 2500);
    }

    function moriGoToYoutube() {
      showEventDialog({
        speaker: 'Mr.Mori',
        icon: 'üòä',
        text: '„Çà„ÅóÔºÅ\n\n„Åì„ÅÆÂãïÁîª„ÇíË¶ã„Çå„Å∞„ÄÅ\nÊú≠ÂπåÊó•Â§ß‰∏≠„ÅÆÂÖ•Ë©¶„Åå\n„Ç∞„ÉÉ„Å®Ë∫´Ëøë„Å´ÊÑü„Åò„Çâ„Çå„Çã„ÅØ„Åö„Å†„ÄÇ\n\nÈ†ëÂºµ„Çå„ÄÅÊú™Êù•„ÅÆÊú≠ÂπåÊó•Â§ßÁîüÔºÅ\n\nüå∏ Êò•„Å´‰ºö„Åä„ÅÜÔºÅ üå∏',
        choices: [{ text: 'ÂãïÁîª„ÇíË¶ã„Çã', action: () => {
          gameState.kitayamaEventDone = true;
          closeEventDialog();
          // Mr.Mori„ÅÆYouTubeÂãïÁîªÔºà„Ç∑„Éß„Éº„ÉàÂãïÁîª„ÉªÁ∏¶Èï∑Ôºâ
          openVideo(VIDEO_IDS.mori, 'üë®‚Äçüè´ Mr.Mori Êú≠ÂπåÊó•Â§ß‰∏≠ÂØæÁ≠ñ', () => {
            setTimeout(() => showEnding(), 500);
          }, false, true);
        }}]
      });
    }

    function moriDecline() {
      showEventDialog({
        speaker: 'Mr.Mori',
        icon: 'üòå',
        text: '„Åù„ÅÜ„Åã„ÄÅ„Åæ„Åü‰ªäÂ∫¶„Å†„Å≠„ÄÇ\n\n„Åß„ÇÇË¶ö„Åà„Å¶„Åä„ÅÑ„Å¶„ÄÇ\n\nÊú≠ÂπåÊó•Â§ß‰∏≠„ÅØ\nÂêõ„ÅÆ„Çà„ÅÜ„Å™Â≠ê„ÇíÂæÖ„Å£„Å¶„ÅÑ„Çã„Çà„ÄÇ\n\nÂêàÊ†º„ÇíÁ•à„Å£„Å¶„ÅÑ„Çã„Åã„Çâ„Å≠ÔºÅ\n\nüå∏ Êò•„Å´‰ºö„Åä„ÅÜÔºÅ üå∏',
        choices: [{ text: '„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ', action: () => {
          gameState.kitayamaEventDone = true;
          closeEventDialog();
          setTimeout(() => showEnding(), 800);
        }}]
      });
    }

    function kitayamaElementaryMessage() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üåü',
        text: '„Åù„ÅÜ„Åã„ÄÇ\n\n„Åß„ÇÇ‰∏≠Â≠¶ÂèóÈ®ì„ÅØ‰∫∫Áîü„ÅßÊúÄÂàù„ÅÆÂ§ß„Åç„Å™ÊåëÊà¶„Å†„ÄÇ\n\n‰∏çÂÆâ„ÇÇ„ÅÇ„Çã„Å†„Çç„ÅÜ„ÄÇ\n„Åß„ÇÇ„ÄÅ„Åì„Åì„Åæ„ÅßÈ†ëÂºµ„Å£„Å¶„Åç„ÅüÂêõ„Å™„ÇâÂ§ß‰∏àÂ§´„ÄÇ\n\nËá™ÂàÜ„Çí‰ø°„Åò„Å¶„ÄÅÊúÄÂæå„Åæ„ÅßË´¶„ÇÅ„Çã„Å™„ÄÇ\n\n...„ÇÇ„ÅÜÂ∞ë„ÅóËÅû„ÅÑ„Å¶„ÅÑ„Åè„Åã„ÅÑÔºü',
        choices: [
          { text: '„Åæ„Å†ËÅû„Åè', action: kitayamaElementaryGoodEnding },
          { text: 'ËÅû„Åè„ÅÆ„Çí„ÇÑ„ÇÅ„Çã', action: kitayamaElementaryForceChoice, canChange: true }
        ]
      });
    }

    function kitayamaElementaryForceChoice() {
      const noBtn = document.querySelector('.choice-btn.no-btn');
      if (noBtn) {
        noBtn.classList.add('changing');
        setTimeout(() => {
          noBtn.textContent = '„ÇÇ„Å£„Å®ËÅû„Åç„Åü„ÅÑ';
          noBtn.classList.remove('changing');
          noBtn.classList.add('forced');
          noBtn.onclick = kitayamaElementaryLongMessage;
        }, 400);
      }
    }

    function kitayamaElementaryGoodEnding() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üí´',
        text: '„Çà„Åó...\n\n„Åù„ÅÆÂßøÂã¢„Åå„ÅÇ„Çå„Å∞Â§ß‰∏àÂ§´„Å†„ÄÇ\n\nÂêõ„ÅÆÂêàÊ†º„ÇíÂøÉ„Åã„ÇâÁ•à„Å£„Å¶„ÅÑ„Çã„Çà„ÄÇ\n\n‚ú® Stay brilliant ‚ú®\n\n...„Åï„ÅÇ„ÄÅË°å„Åç„Åü„Åæ„Åà„ÄÇ\nÊò•„ÅØ„ÇÇ„ÅÜ„Åô„Åê„Åù„Åì„Å†„ÄÇ',
        choices: [{ text: '„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„ÅüÔºÅ', action: () => {
          gameState.kitayamaEventDone = true;
          closeEventDialog();
          setTimeout(() => showEnding(), 800);
        }}]
      });
    }

    function kitayamaElementaryLongMessage() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: '‚ú®',
        text: '„Åµ„Åµ„ÄÅ„Åù„ÅÜ„Åã„Åù„ÅÜ„Åã...\nËÅû„Åç„Åü„ÅÑ„Åã„ÄÇ„Çà„Çç„Åó„ÅÑ„ÄÇ\n\nÂèóÈ®ì„Å®„ÅÑ„ÅÜ„ÅÆ„ÅØ„Å≠„ÄÅÁµêÊûú„Å†„Åë„Åå„Åô„Åπ„Å¶„Åò„ÇÉ„Å™„ÅÑ„ÄÇ„Åì„ÅÆÁµåÈ®ì„ÅßÂæó„Åü„ÄåÂä™Âäõ„Åô„ÇãÂäõ„Äç„ÄåË´¶„ÇÅ„Å™„ÅÑÂøÉ„Äç„ÄåË®àÁîª„ÇíÁ´ã„Å¶„Å¶ÂÆüË°å„Åô„ÇãÂäõ„Äç...„Åì„Çå„Çâ„ÅØ‰∏ÄÁîü„ÅÆË≤°Áî£„Å´„Å™„Çã„ÄÇ',
        choices: [{ text: '...', action: kitayamaElementaryLongMessage2 }]
      });
    }

    function kitayamaElementaryLongMessage2() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üí´',
        text: 'Ë©¶È®ìÂΩìÊó•„ÅØÁ∑äÂºµ„Åô„Çã„Å†„Çç„ÅÜ„ÄÇ„Åß„ÇÇ„ÄÅ„Åù„Çå„ÅØÂêõ„Å†„Åë„Åò„ÇÉ„Å™„ÅÑ„ÄÇÂÖ®Âì°„ÅåÂêå„ÅòÊ∞óÊåÅ„Å°„Å†„ÄÇÊ∑±ÂëºÂê∏„Åó„Å¶„ÄÅ„ÅÑ„Å§„ÇÇÈÄö„Çä„ÅÆËá™ÂàÜ„ÇíÂá∫„Åõ„Å∞„ÅÑ„ÅÑ„ÄÇÂàÜ„Åã„Çâ„Å™„ÅÑÂïèÈ°å„Åå„ÅÇ„Å£„Å¶„ÇÇÁÑ¶„Çã„Å™„ÄÇ„Åß„Åç„ÇãÂïèÈ°å„ÇíÁ¢∫ÂÆü„Å´„ÄÇ',
        choices: [{ text: '...„Å™„Çã„Åª„Å©', action: kitayamaElementaryLongMessage3 }]
      });
    }

    function kitayamaElementaryLongMessage3() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üòÖ',
        text: '„Åù„Åó„Å¶‰Ωï„Çà„ÇäÂ§ßÂàá„Å™„ÅÆ„ÅØ...\n\n‰ΩìË™øÁÆ°ÁêÜ„Å†„ÄÇÁù°Áú†„Çí„Åó„Å£„Åã„ÇäÂèñ„Å£„Å¶...\n\nÊâãÊ¥ó„ÅÑ„ÅÜ„Åå„ÅÑ„ÇíÂøò„Çå„Åö„Å´...\n\n......„Åµ„ÅÖ„ÄÇ\n\n...„Åï„Åô„Åå„Å´Âñã„Çä„Åô„Åé„Åü„ÄÇ\n\nÁßÅ„Å®„Åó„Åü„Åì„Å®„Åå...Â∞ë„ÅóÁñ≤„Çå„Åü„Çà...',
        choices: [{ text: '„ÅäÁñ≤„Çå„Åï„Åæ„Åß„Åô...', action: kitayamaElementaryTiredEnding }]
      });
    }

    function kitayamaElementaryTiredEnding() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üòå',
        text: '„Åæ„ÅÇ...Âêõ„ÅÆ„Åü„ÇÅ„Å†„Åã„Çâ„Å≠...\n\nÁßÅ„ÅÆË®ÄËëâ„ÄÅÂ∞ë„Åó„Åß„ÇÇÂ±ä„ÅÑ„Å¶„ÅÑ„Çå„Å∞Â¨â„Åó„ÅÑ„ÄÇ\n\n...„Åï„ÅÇ„ÄÅ„ÇÇ„ÅÜË°å„Åç„Å™„Åï„ÅÑ„ÄÇ\n\nÂêàÊ†º„ÇíÁ•à„Å£„Å¶„ÅÑ„Çã„Çà„ÄÇ\n\n‚ú® ...Stay...gorgeous... ‚ú®',
        choices: [{ text: '„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„ÅüÔºÅ', action: () => {
          gameState.kitayamaEventDone = true;
          closeEventDialog();
          setTimeout(() => showEnding(), 800);
        }}]
      });
    }

    function kitayamaProposal() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üí´',
        text: '„Åä„Åä„ÄÅÁ¥†Êô¥„Çâ„Åó„ÅÑÔºÅ\n\nÂêõ„ÄÅ„Å™„Åã„Å™„Åã„ÇÑ„Çã„Åò„ÇÉ„Å™„ÅÑ„Åã„ÄÇ\n\nÁßÅ„ÅÆYouTube„ÉÅ„É£„É≥„Éç„É´„Åß\nÁâπÂà•„Å™Ëã±Ë™ûËß£Ë™¨ÂãïÁîª„ÇíÂÖ¨Èñã„Åó„Å¶„ÅÑ„Çã„Çì„Å†„ÄÇ\n\nËÅû„ÅÑ„Å¶„ÅÑ„Åè„Åã„ÅÑÔºü\n\n„Åç„Å£„Å®Âêõ„ÅÆËã±Ë™ûÂäõ„Åå...\n‚ú® Ëºù„ÅçÂá∫„Åô ‚ú® „ÅØ„Åö„Åï„ÄÇ',
        choices: [
          { text: 'ËÅû„Åè', action: goToYoutube },
          { text: 'ËÅû„Åã„Å™„ÅÑ', action: kitayamaForceChoice, canChange: true }
        ]
      });
    }

    function kitayamaForceChoice() {
      const noBtn = document.querySelector('.choice-btn.no-btn');
      if (noBtn) {
        noBtn.classList.add('changing');
        
        setTimeout(() => {
          showEventDialog({
            speaker: '„Ç≠„Çø„É§„Éû',
            icon: 'üòè',
            text: '„Åµ„Åµ...\n\n„ÄåËÅû„Åã„Å™„ÅÑ„Äç„Å†„Å£„Å¶Ôºü\n\n...\n\n„Åù„Çì„Å™ÈÅ∏ÊäûËÇ¢...\nÊúÄÂàù„Åã„Çâ„Å™„Åã„Å£„Åü„ÅÆ„Åï„ÄÇ',
            choices: [
              { text: 'ËÅû„Åè', action: goToYoutube },
              { text: 'ËÅû„Åè', action: goToYoutube }
            ]
          });
        }, 400);
      }
    }

    function goToYoutube() {
      showEventDialog({
        speaker: '„Ç≠„Çø„É§„Éû',
        icon: 'üåü',
        text: '„ÅÑ„ÅÑÈÅ∏Êäû„Å†...\n\nÁßÅ„ÅÆÁæé„Åó„ÅÑËß£Ë™¨„ÇíÂ†™ËÉΩ„Åó„Åü„Åæ„Åà„ÄÇ\n\n„Åß„ÅØ„Åæ„Åü‰ºö„Åä„ÅÜ...\n\n‚ú® Stay gorgeous ‚ú®',
        choices: [{ text: 'ÂãïÁîª„ÇíË¶ã„Çã', action: () => {
          gameState.kitayamaEventDone = true;
          closeEventDialog();
          // Â§ß„Åç„ÅÑÂüã„ÇÅËæº„ÅøÂãïÁîª„ÇíË°®Á§∫„ÄÅÈñâ„Åò„ÅüÂæå„Å´„Ç®„É≥„Éá„Ç£„É≥„Ç∞„Å∏
          openVideo(VIDEO_IDS.kitayama, '‚ú® „Ç≠„Çø„É§„Éû„ÅÆËã±Ë™ûËß£Ë™¨ ‚ú®', () => {
            setTimeout(() => showEnding(), 500);
          }, true);  // true = Â§ß„Åç„ÅÑ„É¢„Éº„ÉÄ„É´
        }}]
      });
    }

    // ========== „Ç®„É≥„Éá„Ç£„É≥„Ç∞ ==========
    function showEnding() {
      // BGM„Çí„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
      if (bgmEnabled && !bgm.paused) {
        let fadeOut = setInterval(() => {
          if (bgm.volume > 0.1) {
            bgm.volume -= 0.1;
          } else {
            bgm.pause();
            clearInterval(fadeOut);
          }
        }, 200);
      }
      endingOverlay.classList.add('active');
    }

    // ========== „Ç§„Éô„É≥„Éà„ÉÄ„Ç§„Ç¢„É≠„Ç∞ ==========
    function showEventDialog(config) {
      gameState.canMove = false;
      stopMove();
      eventOverlay.classList.add('active');
      eventDialog.classList.add('active');
      
      // „Çª„É™„ÉïÂäπÊûúÈü≥„ÇíÂÜçÁîüÔºàBGM„ÅØ„Åù„ÅÆ„Åæ„ÅæÔºâ
      const dialogSound = document.getElementById('dialogSound');
      dialogSound.currentTime = 0;
      dialogSound.play().catch(e => console.log('ÂäπÊûúÈü≥ÂÜçÁîü„Ç®„É©„Éº:', e));
      
      document.getElementById('speakerIcon').textContent = config.icon;
      document.getElementById('speakerName').textContent = config.speaker;
      
      const textEl = document.getElementById('eventText');
      textEl.textContent = '';
      typeWriter(textEl, config.text, 0);

      const choicesEl = document.getElementById('eventChoices');
      choicesEl.innerHTML = '';
      
      config.choices.forEach((choice) => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn' + (choice.canChange ? ' no-btn' : '');
        btn.textContent = choice.text;
        btn.onclick = choice.action;
        choicesEl.appendChild(btn);
      });
    }

    function typeWriter(element, text, index) {
      if (index < text.length) {
        element.textContent += text.charAt(index);
        setTimeout(() => typeWriter(element, text, index + 1), 25);
      }
    }

    function closeEventDialog() {
      eventOverlay.classList.remove('active');
      eventDialog.classList.remove('active');
    }

    // ========== ÊÑüÂòÜÁ¨¶„Ç®„Éï„Çß„ÇØ„Éà ==========
    function showExclamation(element) {
      const rect = element.getBoundingClientRect();
      const excl = document.createElement('div');
      excl.className = 'exclamation';
      excl.textContent = '‚ùó';
      excl.style.left = (rect.left + rect.width / 2 - 17) + 'px';
      excl.style.top = (rect.top - 45) + 'px';
      document.body.appendChild(excl);
      
      setTimeout(() => excl.remove(), 1500);
    }

    // ========== Èõ™„ÉªÊòü„ÅÆÁîüÊàê ==========
    function createSnowflakes() {
      const container = document.getElementById('snowflakes');
      const flakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚Ä¢'];
      
      for (let i = 0; i < 40; i++) {
        const flake = document.createElement('div');
        flake.className = 'snowflake';
        flake.textContent = flakeChars[Math.floor(Math.random() * flakeChars.length)];
        flake.style.left = Math.random() * 100 + '%';
        flake.style.fontSize = (Math.random() * 0.7 + 0.4) + 'em';
        flake.style.animationDuration = (Math.random() * 5 + 6) + 's';
        flake.style.animationDelay = (Math.random() * 10) + 's';
        container.appendChild(flake);
      }
    }

    function createStars() {
      const container = document.getElementById('stars');
      
      for (let i = 0; i < 60; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = (Math.random() * 2) + 's';
        container.appendChild(star);
      }
    }

    // ========== „Ç≠„Éº„Éú„Éº„ÉâÊìç‰ΩúÔºàPCÁî®Ôºâ ==========
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') movePlayer('left');
      else if (e.key === 'ArrowRight') movePlayer('right');
    });

    // ========== BGMÂà∂Âæ° ==========
    const bgm = document.getElementById('bgm');
    const bgmBtn = document.getElementById('bgmBtn');
    const bgmPrompt = document.getElementById('bgmPrompt');
    let bgmEnabled = false;

    // ========== YouTubeÂãïÁîªË®≠ÂÆö ==========
    const VIDEO_IDS = {
      superHappy: 'Rl6WnNdDf4g',  // Super happy„ÅÆÊå®Êã∂ÂãïÁîª
      kitayama: 'XpB7llDefjg',     // „Ç≠„Çø„É§„Éû„ÅÆËã±Ë™ûËß£Ë™¨
      mori: '8nU6C3uJ42U'          // Mr.Mori„ÅÆÊú≠ÂπåÊó•Â§ß‰∏≠ÂØæÁ≠ñÔºà„Ç∑„Éß„Éº„ÉàÂãïÁîªÔºâ
    };

    // ========== ÂÆâÂÖ®„Å´Âà•„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅßÈñã„ÅèÈñ¢Êï∞ ==========
    function openInNewTab(url) {
      // Êñ∞„Åó„ÅÑ„Ç¶„Ç£„É≥„Éâ„Ç¶„Å®„Åó„Å¶Èñã„ÅèÔºà„Çø„Éñ„Åß„ÅØ„Å™„Åè„Ç¶„Ç£„É≥„Éâ„Ç¶Ôºâ
      const newWindow = window.open(url, '_blank', 'width=1024,height=768,menubar=yes,toolbar=yes,location=yes,status=yes,scrollbars=yes,resizable=yes');
      // „Éï„Ç©„Éº„Ç´„Çπ„ÇíÊñ∞„Åó„ÅÑ„Ç¶„Ç£„É≥„Éâ„Ç¶„Å´
      if (newWindow) {
        newWindow.focus();
      }
    }

    // ========== Â§ñÈÉ®„Çµ„Ç§„ÉàÂüã„ÇÅËæº„Åø„É¢„Éº„ÉÄ„É´Âà∂Âæ° ==========
    const siteModal = document.getElementById('siteModal');
    const siteIframe = document.getElementById('siteIframe');
    const siteModalTitle = document.getElementById('siteModalTitle');

    function openSite(url, title) {
      // BGM„Çí‰∏ÄÊôÇÂÅúÊ≠¢
      if (bgmEnabled && !bgm.paused) {
        bgm.pause();
      }
      
      siteModalTitle.textContent = title || 'üìù Â§ñÈÉ®„Çµ„Ç§„Éà';
      siteIframe.src = url;
      siteModal.classList.add('active');
    }

    function closeSite() {
      siteIframe.src = '';
      siteModal.classList.remove('active');
      
      // BGM„ÇíÂÜçÈñã
      if (bgmEnabled) {
        bgm.play().catch(e => console.log('BGMÂÜçÁîü„Ç®„É©„Éº:', e));
      }
    }

    // ========== ÂãïÁîª„É¢„Éº„ÉÄ„É´Âà∂Âæ° ==========
    const videoModal = document.getElementById('videoModal');
    const videoIframe = document.getElementById('videoIframe');
    const videoModalTitle = document.getElementById('videoModalTitle');
    let videoCallback = null;

    function openVideo(videoId, title, callback, isLarge = false, isShorts = false) {
      // BGM„Çí‰∏ÄÊôÇÂÅúÊ≠¢
      if (bgmEnabled && !bgm.paused) {
        bgm.pause();
      }
      
      videoModalTitle.textContent = title || 'üì∫ ÂãïÁîª„ÇíË¶ã„Çã';
      videoIframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
      
      // „É¢„Éº„ÉÄ„É´„ÅÆ„ÇØ„É©„Çπ„Çí„É™„Çª„ÉÉ„Éà
      videoModal.classList.remove('large', 'shorts');
      
      // Â§ß„Åç„ÅÑ„É¢„Éº„ÉÄ„É´„Åã„Å©„ÅÜ„Åã
      if (isShorts) {
        videoModal.classList.add('shorts');
      } else if (isLarge) {
        videoModal.classList.add('large');
      }
      
      videoModal.classList.add('active');
      videoCallback = callback;
    }

    function closeVideo() {
      videoIframe.src = '';
      videoModal.classList.remove('active');
      videoModal.classList.remove('large');
      videoModal.classList.remove('shorts');
      
      // BGM„ÇíÂÜçÈñã
      if (bgmEnabled) {
        bgm.play().catch(e => console.log('BGMÂÜçÁîü„Ç®„É©„Éº:', e));
      }
      
      // „Ç≥„Éº„É´„Éê„ÉÉ„ÇØÂÆüË°å
      if (videoCallback) {
        videoCallback();
        videoCallback = null;
      }
    }

    function startWithBGM() {
      bgmEnabled = true;
      bgm.volume = 0.5; // Èü≥Èáè50%
      bgm.play().catch(e => console.log('BGMÂÜçÁîü„Ç®„É©„Éº:', e));
      bgmBtn.textContent = 'üîä BGM';
      bgmBtn.classList.add('playing');
      bgmPrompt.classList.add('hidden');
      // „ÉÅ„É•„Éº„Éà„É™„Ç¢„É´Ë°®Á§∫
      showTutorial();
    }

    function startWithoutBGM() {
      bgmEnabled = false;
      bgmPrompt.classList.add('hidden');
      // „ÉÅ„É•„Éº„Éà„É™„Ç¢„É´Ë°®Á§∫
      showTutorial();
    }

    // ========== „ÉÅ„É•„Éº„Éà„É™„Ç¢„É´ ==========
    const tutorialOverlay = document.getElementById('tutorialOverlay');
    let tutorialStep = 1;

    function showTutorial() {
      tutorialOverlay.classList.add('active');
      gameState.canMove = false;
    }

    function nextTutorialStep() {
      document.getElementById('tutorialStep1').classList.remove('active');
      document.getElementById('tutorialStep2').classList.add('active');
      tutorialStep = 2;
    }

    function startGame() {
      tutorialOverlay.classList.add('hidden');
      setTimeout(() => {
        tutorialOverlay.classList.remove('active');
        tutorialOverlay.classList.remove('hidden');
        gameState.canMove = true;
      }, 500);
    }

    function toggleBGM() {
      if (bgm.paused) {
        bgm.play().catch(e => console.log('BGMÂÜçÁîü„Ç®„É©„Éº:', e));
        bgmBtn.textContent = 'üîä BGM';
        bgmBtn.classList.add('playing');
        bgmEnabled = true;
      } else {
        bgm.pause();
        bgmBtn.textContent = 'üîá BGM';
        bgmBtn.classList.remove('playing');
        bgmEnabled = false;
      }
    }

    // ========== ÂàùÊúüÂåñ ==========
    function init() {
      createSnowflakes();
      createStars();
      player.style.left = gameState.playerX + '%';
      frisk.classList.add('flip');
      
      // Èï∑Êäº„Åó„É°„Éã„É•„ÉºÔºà„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„É°„Éã„É•„ÉºÔºâ„ÇíÁÑ°ÂäπÂåñ
      document.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }, { passive: false });
      
      // Èï∑Êäº„Åó„Å´„Çà„ÇãÈÅ∏Êäû„ÇíÁÑ°ÂäπÂåñ
      document.addEventListener('selectstart', (e) => {
        e.preventDefault();
        return false;
      }, { passive: false });
      
      // Èï∑Êäº„Åó„Çø„Ç§„Éû„Éº„Çí„Ç≠„É£„É≥„Çª„É´ÔºàChrome„ÅÆÈï∑Êäº„Åó„É°„Éã„É•„ÉºÂØæÁ≠ñÔºâ
      let longPressTimer = null;
      
      document.addEventListener('touchstart', (e) => {
        // Èï∑Êäº„Åó„Å´„Çà„Çã„É°„Éã„É•„ÉºË°®Á§∫„ÇíÈò≤„Åê
        if (longPressTimer) clearTimeout(longPressTimer);
        longPressTimer = setTimeout(() => {
          // ‰Ωï„ÇÇ„Åó„Å™„ÅÑÔºà„Éá„Éï„Ç©„É´„ÉàÂãï‰Ωú„Çí„Éñ„É≠„ÉÉ„ÇØÔºâ
        }, 500);
      }, { passive: true });
      
      document.addEventListener('touchend', () => {
        if (longPressTimer) {
          clearTimeout(longPressTimer);
          longPressTimer = null;
        }
      }, { passive: true });
      
      document.addEventListener('touchmove', () => {
        if (longPressTimer) {
          clearTimeout(longPressTimer);
          longPressTimer = null;
        }
      }, { passive: true });
      
      // ÁîªÂÉè„ÅÆÈï∑Êäº„Åó„Éâ„É©„ÉÉ„Ç∞„ÇíÁÑ°ÂäπÂåñ
      document.addEventListener('dragstart', (e) => {
        e.preventDefault();
        return false;
      });
    }

    init();
  </script>
</body>
</html>

